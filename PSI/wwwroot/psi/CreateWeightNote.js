var CreateWeightNotePageClass = /** @class */ (function () {
    function CreateWeightNotePageClass(baseUrl) {
        if (baseUrl === void 0) { baseUrl = ""; }
        this.BaseUrl = baseUrl;
    }
    CreateWeightNotePageClass.prototype.IniPageEvent = function () {
        // Page Field
        var fullWeight = $('#VE_PurchaseWeightNote_FullWeightTime').get(0);
        var defectiveWeight = $('#VE_PurchaseWeightNote_DefectiveWeight').get(0);
        var unitPrice = $('#VE_PurchaseWeightNote_UnitPrice').get(0);
        var traficUnitPrice = $('#VE_PurchaseWeightNote_TraficUnitPrice').get(0);
        var weightFee = $('#VE_PurchaseWeightNote_ThirdWeightFee').get(0);
        var ishasTaxList = $(".ishas_tax").get();
        // Logic        
        //fullWeight.addEventListener('keyup', this.CaculateAllFee);
        //defectiveWeight.addEventListener('keyup', this.CaculateAllFee);
        //unitPrice.addEventListener('keyup', this.CaculateAllFee);
        //traficUnitPrice.addEventListener('keyup', this.CaculateAllFee);
        //weightFee.addEventListener('keyup', this.CaculateAllFee);
        //ishasTaxList.forEach((item) => item.addEventListener('change', this.CaculateAllFee));
    };
    ;
    CreateWeightNotePageClass.prototype.ReSetCarNoItems = function (carNoIdObj, dataObjLs) {
        carNoIdObj.html(''); // 選項清空
        var defaultOption = new Option("0.新車牌", "0", false, false);
        carNoIdObj.append(defaultOption);
        dataObjLs.forEach(function (item) {
            var newOption = new Option(item.carName, item.id, false, false);
            carNoIdObj.append(newOption);
        });
    };
    CreateWeightNotePageClass.prototype.ShowList = function () {
        // 傳入結果 根據結果檢查是否為新增不為新增的則Pass，不再保留清單的則移除
        var _this = this;
        //let userSelect = ($('.select2bs4').find(':selected').get() as HTMLSelectElement[]);
        // User畫面所選
        var userSelect = $('.select2bs4').find(':selected').toArray();
        // 準備要Show
        var showList = $('#evenProductLs li').toArray().concat($('#oddProductLs li').toArray());
        // 要新增的就新增
        userSelect.filter(function (item) {
            return showList.map(function (litag) { return litag.dataset.value; }).indexOf(item.value) === -1;
        }).forEach(function (item) { return _this.AppendToShowList(item); });
        // 要刪除的就刪除    
        showList.filter(function (litag) {
            return userSelect.map(function (item) { return item.value; }).indexOf(litag.dataset.value) === -1;
        }).forEach(function (item) { return item.remove(); });
    };
    CreateWeightNotePageClass.prototype.ShowList2 = function (userSelectedVals, evenProductLiTagLs, oddProductLiTagLs) {
        // 傳入結果 根據結果檢查是否為新增不為新增的則Pass，不再保留清單的則移除
        // User畫面所選
        var userSelect = $('.select2bs4').find(':selected').toArray();
        var userSelect2 = $('.select2bs4').find(':selected').toArray()
            .map(function (item) { return item.value; });
        // 差集
        // 要新增的就新增
        //userSelect.filter(item => {
        //    return showList.map(litag => litag.dataset.value).indexOf(item.value) === -1;
        //}).forEach((item) => this.AppendToShowList(item));
        console.log(userSelect2);
    };
    CreateWeightNotePageClass.prototype.GetShowProdItemIds = function (testPostObj) {
        var shoList = testPostObj.find('input').toArray();
        if (shoList) {
            var abc2 = shoList.filter(function (item, index) {
                return item.name.includes("ProductId");
            }).map(function (item) { return item.value; });
            //let abc = shoList.map((item, index) => {
            //    return (item.name.querySelector(`input[name="VE_PurchaseIngredientLs[${index}].ProductId"`) as HTMLInputElement).value;
            //})
            return abc2;
        }
    };
    CreateWeightNotePageClass.prototype.AppendToShowList = function (prodItem) {
        var allShowList = $("#evenProductLs li").toArray().concat($("#oddProductLs li").toArray());
        var iMinusTag = document.createElement("i");
        iMinusTag.classList.add("fas");
        iMinusTag.classList.add("fa-minus-circle");
        iMinusTag.style.cursor = "pointer";
        iMinusTag.style.color = "blue";
        var iPlusTag = document.createElement("i");
        iPlusTag.classList.add("fas");
        iPlusTag.classList.add("fa-plus-circle");
        iPlusTag.style.cursor = "pointer";
        iPlusTag.style.color = "red";
        var spanTag = document.createElement("span");
        var liTag = document.createElement("li");
        liTag.dataset.text = prodItem.textContent;
        liTag.textContent = prodItem.textContent + " \u00A0\u00A0";
        liTag.dataset.value = prodItem.value.toString();
        liTag.dataset.percent = allShowList.length === 0 ? "90" : "10";
        liTag.appendChild(iMinusTag);
        liTag.appendChild(spanTag);
        liTag.appendChild(iPlusTag);
        //AddHidden(liTag, index);
        // Action    
        var showList = allShowList.length % 2 === 0 ?
            document.getElementById("evenProductLs") :
            document.getElementById("oddProductLs");
        showList === null || showList === void 0 ? void 0 : showList.appendChild(liTag);
        var allShowList2 = $("#evenProductLs li").toArray().concat($("#oddProductLs li").toArray());
        allShowList2.forEach(function (item, index) {
            Array.from(item.getElementsByTagName('input')).forEach(function (subItem) {
                subItem.remove();
            });
            // AddHidden(item as HTMLLIElement, index);
        });
        //Event
        var thisObj = this;
        iMinusTag.addEventListener('click', function () {
            var nowLITag = this.parentElement;
            thisObj.CaculatePercent(nowLITag, false);
            thisObj.RefreshProdItemPercent();
            thisObj.ShowTotalInfo();
            thisObj.SetBindingValue();
            var allShowList3 = $("#evenProductLs li").toArray().concat($("#oddProductLs li").toArray());
            allShowList3.forEach(function (item, index) {
                Array.from(item.getElementsByTagName('input')).forEach(function (subItem) {
                    subItem.remove();
                });
                thisObj.AddHidden(item, index);
            });
        });
        iPlusTag.addEventListener('click', function () {
            var nowLITag = this.parentElement;
            thisObj.CaculatePercent(nowLITag, true);
            thisObj.RefreshProdItemPercent();
            thisObj.ShowTotalInfo();
            thisObj.SetBindingValue();
            var allShowList4 = $("#evenProductLs li").toArray().concat($("#oddProductLs li").toArray());
            allShowList4.forEach(function (item, index) {
                Array.from(item.getElementsByTagName('input')).forEach(function (subItem) {
                    subItem.remove();
                });
                thisObj.AddHidden(item, index);
            });
        });
    };
    ;
    CreateWeightNotePageClass.prototype.AppendToShowList2 = function (prodItem) {
    };
    ;
    CreateWeightNotePageClass.prototype.RefreshProdItemPercent = function () {
        var allProdItems = $('#evenProductLs li').toArray().concat($('#oddProductLs li').toArray());
        allProdItems.forEach(function (item) {
            var spanTag = item.querySelector("span");
            spanTag.innerHTML = "\u00A0\u00A0" + item.dataset.percent + "%\u00A0\u00A0";
        });
    };
    CreateWeightNotePageClass.prototype.AddHidden = function (theLi, index) {
        // Create a hidden input element, and append it to the li:
        var nameProperty = document.createElement("input");
        nameProperty.className = "modelbind";
        nameProperty.type = "hidden";
        nameProperty.name = "VE_PurchaseIngredientLs[" + index + "].ItemName";
        nameProperty.value = theLi.dataset.text;
        var valueProperty = document.createElement("input");
        nameProperty.className = "modelbind";
        valueProperty.type = "hidden";
        valueProperty.name = "VE_PurchaseIngredientLs[" + index + "].ProductId";
        valueProperty.value = theLi.dataset.value;
        var percentProperty = document.createElement("input");
        nameProperty.className = "modelbind";
        percentProperty.type = "hidden";
        percentProperty.name = "VE_PurchaseIngredientLs[" + index + "].ItemPercent";
        percentProperty.value = theLi.dataset.percent;
        theLi.appendChild(nameProperty);
        theLi.appendChild(valueProperty);
        theLi.appendChild(percentProperty);
    };
    CreateWeightNotePageClass.prototype.ShowTotalInfo = function () {
        var _a;
        var allProdItems = $('#evenProductLs li').toArray().concat($('#oddProductLs li').toArray());
        var allPercent = 0;
        var maxItem;
        allProdItems.forEach(function (item) {
            allPercent = +item.dataset.percent + allPercent;
            if (!maxItem) {
                maxItem = item;
            }
            else {
                maxItem = +maxItem.dataset.percent > +item.dataset.percent ? maxItem : item;
            }
        });
        var totalInfo = document.getElementById("total");
        totalInfo.querySelectorAll("span").forEach(function (item) { item.remove(); });
        var itemSpan = document.createElement("span");
        itemSpan.innerHTML = "\uFF0C\u5DF2\u9078" + allProdItems.length + "\u9805";
        var percentSpan = document.createElement("span");
        percentSpan.innerHTML = "\uFF0C\u6BD4\u4F8B\u52A0\u7E3D:" + allPercent + "%";
        if (allPercent > 100)
            percentSpan.style.color = "red";
        var recognitionSpan = document.createElement("span");
        //let haha = document.querySelector('.select2bs4 :checked') as HTMLOptionElement;
        //alert(haha.value);
        //let recognitionText = ($('.select2bs4').find(':selected').toArray() as HTMLSelectElement[])
        //    .filter(item => { return item.value === maxItem.dataset.value; })[0]?.textContent ?? "無";
        recognitionSpan.innerHTML = "\u8A8D\u5217\u9805\u76EE : " + ((_a = maxItem === null || maxItem === void 0 ? void 0 : maxItem.dataset.text) !== null && _a !== void 0 ? _a : "無");
        totalInfo.appendChild(recognitionSpan);
        totalInfo.appendChild(itemSpan);
        totalInfo.appendChild(percentSpan);
        if (allProdItems.length > 0)
            $('#IsPassPurchase').val("true");
        else
            $('#IsPassPurchase').val("false");
    };
    CreateWeightNotePageClass.prototype.SetBindingValue = function () {
        var allProdItems = $('#evenProductLs li').toArray().concat($('#oddProductLs li').toArray());
        var purchaseDetailInfos = [];
        allProdItems.forEach(function (item) {
            var purchaseDetailInfo = new PurchaseDetailInfo2();
            purchaseDetailInfo.Value = item.dataset.value;
            purchaseDetailInfo.Name = item.textContent;
            purchaseDetailInfo.Percent = parseInt(item.dataset.percent, 10);
            purchaseDetailInfos.push(purchaseDetailInfo);
        });
        if (purchaseDetailInfos.length === 0)
            $('#SelectPurchaseDetailInfos').val(null);
        else {
            $('#SelectPurchaseDetailInfos').val(JSON.stringify(purchaseDetailInfos));
        }
    };
    CreateWeightNotePageClass.prototype.CaculatePercent = function (curProdItem, isPlus) {
        var curVal = curProdItem.dataset.percent;
        var newVal = isPlus ? +curVal + 10 : +curVal - 10;
        if (newVal > 100)
            newVal = 100;
        if (newVal < 0)
            newVal = 0;
        curProdItem.dataset.percent = newVal.toString();
        //var el = document.getElementById("outside");
        //el.addEventListener("click", modifyText, false);
    };
    return CreateWeightNotePageClass;
}());
;
var PurchaseDetailInfo2 = /** @class */ (function () {
    function PurchaseDetailInfo2() {
    }
    return PurchaseDetailInfo2;
}());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ3JlYXRlV2VpZ2h0Tm90ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NjcmlwdHMvQ3JlYXRlV2VpZ2h0Tm90ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtJQVNJLG1DQUFZLE9BQW9CO1FBQXBCLHdCQUFBLEVBQUEsWUFBb0I7UUFDNUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7SUFDM0IsQ0FBQztJQUdNLGdEQUFZLEdBQW5CO1FBQ0ksYUFBYTtRQUNiLElBQUksVUFBVSxHQUFHLENBQUMsQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNuRSxJQUFJLGVBQWUsR0FBRyxDQUFDLENBQUMsd0NBQXdDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekUsSUFBSSxTQUFTLEdBQUcsQ0FBQyxDQUFDLGtDQUFrQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdELElBQUksZUFBZSxHQUFHLENBQUMsQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6RSxJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUMsdUNBQXVDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEUsSUFBSSxZQUFZLEdBQUcsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBRXpDLGdCQUFnQjtRQUNoQiw0REFBNEQ7UUFDNUQsaUVBQWlFO1FBQ2pFLDJEQUEyRDtRQUMzRCxpRUFBaUU7UUFDakUsMkRBQTJEO1FBQzNELHVGQUF1RjtJQUMzRixDQUFDO0lBQUEsQ0FBQztJQUVLLG1EQUFlLEdBQXRCLFVBQXVCLFVBQStCLEVBQUUsU0FBUztRQUM3RCxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUUsT0FBTztRQUM3QixJQUFJLGFBQWEsR0FBRyxJQUFJ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Y2VzQ29udGVudCI6WyJjbGFzcyBDcmVhdGVXZWlnaHROb3RlUGFnZUNsYXNzIHtcclxuICAgIC8vIEdsb2JhbFxyXG5cclxuICAgIC8vIFJlYWR5IFBvc3RcclxuXHJcblxyXG5cclxuXHJcbiAgICBCYXNlVXJsOiBzdHJpbmc7XHJcbiAgICBjb25zdHJ1Y3RvcihiYXNlVXJsOiBzdHJpbmcgPSBcIlwiKSB7XHJcbiAgICAgICAgdGhpcy5CYXNlVXJsID0gYmFzZVVybDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHVibGljIEluaVBhZ2VFdmVudCgpIHtcclxuICAgICAgICAvLyBQYWdlIEZpZWxkXHJcbiAgICAgICAgbGV0IGZ1bGxXZWlnaHQgPSAkKCcjVkVfUHVyY2hhc2VXZWlnaHROb3RlX0Z1bGxXZWlnaHRUaW1lJykuZ2V0KDApO1xyXG4gICAgICAgIGxldCBkZWZlY3RpdmVXZWlnaHQgPSAkKCcjVkVfUHVyY2hhc2VXZWlnaHROb3RlX0RlZmVjdGl2ZVdlaWdodCcpLmdldCgwKTtcclxuICAgICAgICBsZXQgdW5pdFByaWNlID0gJCgnI1ZFX1B1cmNoYXNlV2VpZ2h0Tm90ZV9Vbml0UHJpY2UnKS5nZXQoMCk7XHJcbiAgICAgICAgbGV0IHRyYWZpY1VuaXRQcmljZSA9ICQoJyNWRV9QdXJjaGFzZVdlaWdodE5vdGVfVHJhZmljVW5pdFByaWNlJykuZ2V0KDApO1xyXG4gICAgICAgIGxldCB3ZWlnaHRGZWUgPSAkKCcjVkVfUHVyY2hhc2VXZWlnaHROb3RlX1RoaXJkV2VpZ2h0RmVlJykuZ2V0KDApO1xyXG4gICAgICAgIGxldCBpc2hhc1RheExpc3QgPSAkKFwiLmlzaGFzX3RheFwiKS5nZXQoKTtcclxuXHJcbiAgICAgICAgLy8gTG9naWMgICAgICAgIFxyXG4gICAgICAgIC8vZnVsbFdlaWdodC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRoaXMuQ2FjdWxhdGVBbGxGZWUpO1xyXG4gICAgICAgIC8vZGVmZWN0aXZlV2VpZ2h0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5DYWN1bGF0ZUFsbEZlZSk7XHJcbiAgICAgICAgLy91bml0UHJpY2UuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLkNhY3VsYXRlQWxsRmVlKTtcclxuICAgICAgICAvL3RyYWZpY1VuaXRQcmljZS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRoaXMuQ2FjdWxhdGVBbGxGZWUpO1xyXG4gICAgICAgIC8vd2VpZ2h0RmVlLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5DYWN1bGF0ZUFsbEZlZSk7XHJcbiAgICAgICAgLy9pc2hhc1RheExpc3QuZm9yRWFjaCgoaXRlbSkgPT4gaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB0aGlzLkNhY3VsYXRlQWxsRmVlKSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHB1YmxpYyBSZVNldENhck5vSXRlbXMoY2FyTm9JZE9iajogSlF1ZXJ5PEhUTUxFbGVtZW50PiwgZGF0YU9iakxzKSB7XHJcbiAgICAgICAgY2FyTm9JZE9iai5odG1sKCcnKTsgIC8vIOmBuOmghea4heepulxyXG4gICAgICAgIGxldCBkZWZhdWx0T3B0aW9uID0gbmV3IE9wdGlvbihcIjAu5paw6LuK54mMXCIsIFwiMFwiLCBmYWxzZSwgZmFsc2UpO1xyXG4gICAgICAgIGNhck5vSWRPYmouYXBwZW5kKGRlZmF1bHRPcHRpb24pO1xyXG4gICAgICAgIGRhdGFPYmpMcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7ICAvLyDmuIXllq7poIXnm65cclxuICAgICAgICAgICAgbGV0IG5ld09wdGlvbiA9IG5ldyBPcHRpb24oaXRlbS5jYXJOYW1lLCBpdGVtLmlkLCBmYWxzZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICBjYXJOb0lkT2JqLmFwcGVuZChuZXdPcHRpb24pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwdWJsaWMgU2hvd0xpc3QoKSB7XHJcblxyXG4gICAgICAgIC8vIOWCs+WFpee1kOaenCDmoLnmk5rntZDmnpzmqqLmn6XmmK/lkKbngrrmlrDlop7kuI3ngrrmlrDlop7nmoTliYdQYXNz77yM5LiN5YaN5L+d55WZ5riF5Zau55qE5YmH56e76ZmkXHJcblxyXG5cclxuICAgICAgICAvL2xldCB1c2VyU2VsZWN0ID0gKCQoJy5zZWxlY3QyYnM0JykuZmluZCgnOnNlbGVjdGVkJykuZ2V0KCkgYXMgSFRNTFNlbGVjdEVsZW1lbnRbXSk7XHJcbiAgICAgICAgLy8gVXNlcueVq+mdouaJgOmBuFxyXG4gICAgICAgIGxldCB1c2VyU2VsZWN0ID0gJCgnLnNlbGVjdDJiczQnKS5maW5kKCc6c2VsZWN0ZWQnKS50b0FycmF5KCkgYXMgSFRNTFNlbGVjdEVsZW1lbnRbXTtcclxuXHJcbiAgICAgICAgLy8g5rqW5YKZ6KaBU2hvd1xyXG4gICAgICAgIGxldCBzaG93TGlzdCA9ICQoJyNldmVuUHJvZHVjdExzIGxpJykudG9BcnJheSgpLmNvbmNhdCgkKCcjb2RkUHJvZHVjdExzIGxpJykudG9BcnJheSgpKSBhcyBIVE1MTElFbGVtZW50W107XHJcblxyXG5cclxuXHJcbiAgICAgICAgLy8g6KaB5paw5aKe55qE5bCx5paw5aKeXHJcbiAgICAgICAgdXNlclNlbGVjdC5maWx0ZXIoaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBzaG93TGlzdC5tYXAobGl0YWcgPT4gbGl0YWcuZGF0YXNldC52YWx1ZSkuaW5kZXhPZihpdGVtLnZhbHVlKSA9PT0gLTE7XHJcbiAgICAgICAgfSkuZm9yRWFjaCgoaXRlbSkgPT4gdGhpcy5BcHBlbmRUb1Nob3dMaXN0KGl0ZW0pKTtcclxuICAgICAgICAvLyDopoHliKrpmaTnmoTlsLHliKrpmaQgICAgXHJcbiAgICAgICAgc2hvd0xpc3QuZmlsdGVyKGxpdGFnID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHVzZXJTZWxlY3QubWFwKGl0ZW0gPT4gaXRlbS52YWx1ZSkuaW5kZXhPZihsaXRhZy5kYXRhc2V0LnZhbHVlKSA9PT0gLTE7XHJcbiAgICAgICAgfSkuZm9yRWFjaChpdGVtID0+IGl0ZW0ucmVtb3ZlKCkpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwdWJsaWMgU2hvd0xpc3QyKHVzZXJTZWxlY3RlZFZhbHM6IHN0cmluZ1tdLFxyXG4gICAgICAgIGV2ZW5Qcm9kdWN0TGlUYWdMczogSFRNTExJRWxlbWVudFtdLFxyXG4gICAgICAgIG9kZFByb2R1Y3RMaVRhZ0xzOiBIVE1MTElFbGVtZW50W10pIHtcclxuXHJcbiAgICAgICAgLy8g5YKz5YWl57WQ5p6cIOagueaTmue1kOaenOaqouafpeaYr+WQpueCuuaWsOWinuS4jeeCuuaWsOWinueahOWJh1Bhc3PvvIzkuI3lho3kv53nlZnmuIXllq7nmoTliYfnp7vpmaRcclxuXHJcblxyXG4gICAgICAgIC8vIFVzZXLnlavpnaLmiYDpgbhcclxuICAgICAgICBsZXQgdXNlclNlbGVjdCA9ICQoJy5zZWxlY3QyYnM0JykuZmluZCgnOnNlbGVjdGVkJykudG9BcnJheSgpO1xyXG4gICAgICAgIGxldCB1c2VyU2VsZWN0MiA9ICgkKCcuc2VsZWN0MmJzNCcpLmZpbmQoJzpzZWxlY3RlZCcpLnRvQXJyYXkoKSBhcyBIVE1MT3B0aW9uRWxlbWVudFtdKVxyXG4gICAgICAgICAgICAubWFwKGl0ZW0gPT4gaXRlbS52YWx1ZSk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgLy8g5beu6ZuGXHJcbiAgICAgICAgLy8g6KaB5paw5aKe55qE5bCx5paw5aKeXHJcbiAgICAgICAgLy91c2VyU2VsZWN0LmZpbHRlcihpdGVtID0+IHtcclxuICAgICAgICAvLyAgICByZXR1cm4gc2hvd0xpc3QubWFwKGxpdGFnID0+IGxpdGFnLmRhdGFzZXQudmFsdWUpLmluZGV4T2YoaXRlbS52YWx1ZSkgPT09IC0xO1xyXG4gICAgICAgIC8vfSkuZm9yRWFjaCgoaXRlbSkgPT4gdGhpcy5BcHBlbmRUb1Nob3dMaXN0KGl0ZW0pKTtcclxuXHJcblxyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyh1c2VyU2VsZWN0Mik7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBHZXRTaG93UHJvZEl0ZW1JZHModGVzdFBvc3RPYmo6IEpRdWVyeTxIVE1MRGl2RWxlbWVudD4pOiBzdHJpbmdbXSB7XHJcblxyXG4gICAgICAgIGxldCBzaG9MaXN0ID0gdGVzdFBvc3RPYmouZmluZCgnaW5wdXQnKS50b0FycmF5KCk7XHJcbiAgICAgICAgaWYgKHNob0xpc3QpIHtcclxuXHJcbiAgICAgICAgICAgIGxldCBhYmMyID0gc2hvTGlzdC5maWx0ZXIoKGl0ZW0sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lLmluY2x1ZGVzKFwiUHJvZHVjdElkXCIpO1xyXG4gICAgICAgICAgICB9KS5tYXAoaXRlbSA9PiBpdGVtLnZhbHVlKTtcclxuXHJcblxyXG4gICAgICAgICAgICAvL2xldCBhYmMgPSBzaG9MaXN0Lm1hcCgoaXRlbSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgLy8gICAgcmV0dXJuIChpdGVtLm5hbWUucXVlcnlTZWxlY3RvcihgaW5wdXRbbmFtZT1cIlZFX1B1cmNoYXNlSW5ncmVkaWVudExzWyR7aW5kZXh9XS5Qcm9kdWN0SWRcImApIGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlO1xyXG4gICAgICAgICAgICAvL30pXHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYWJjMjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyBBcHBlbmRUb1Nob3dMaXN0KHByb2RJdGVtOiBIVE1MU2VsZWN0RWxlbWVudCkge1xyXG4gICAgICAgIGNvbnN0IGFsbFNob3dMaXN0ID0gJChcIiNldmVuUHJvZHVjdExzIGxpXCIpLnRvQXJyYXkoKS5jb25jYXQoJChcIiNvZGRQcm9kdWN0THMgbGlcIikudG9BcnJheSgpKTtcclxuXHJcblxyXG4gICAgICAgIGNvbnN0IGlNaW51c1RhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpXCIpO1xyXG4gICAgICAgIGlNaW51c1RhZy5jbGFzc0xpc3QuYWRkKFwiZmFzXCIpO1xyXG4gICAgICAgIGlNaW51c1RhZy5jbGFzc0xpc3QuYWRkKFwiZmEtbWludXMtY2lyY2xlXCIpO1xyXG4gICAgICAgIGlNaW51c1RhZy5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcclxuICAgICAgICBpTWludXNUYWcuc3R5bGUuY29sb3IgPSBcImJsdWVcIjtcclxuICAgICAgICBjb25zdCBpUGx1c1RhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpXCIpO1xyXG4gICAgICAgIGlQbHVzVGFnLmNsYXNzTGlzdC5hZGQoXCJmYXNcIik7XHJcbiAgICAgICAgaVBsdXNUYWcuY2xhc3NMaXN0LmFkZChcImZhLXBsdXMtY2lyY2xlXCIpO1xyXG4gICAgICAgIGlQbHVzVGFnLnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiO1xyXG4gICAgICAgIGlQbHVzVGFnLnN0eWxlLmNvbG9yID0gXCJyZWRcIjtcclxuICAgICAgICBjb25zdCBzcGFuVGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIikgYXMgSFRNTFNwYW5FbGVtZW50O1xyXG5cclxuXHJcbiAgICAgICAgY29uc3QgbGlUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIikgYXMgSFRNTExJRWxlbWVudDtcclxuICAgICAgICBsaVRhZy5kYXRhc2V0LnRleHQgPSBwcm9kSXRlbS50ZXh0Q29udGVudDtcclxuICAgICAgICBsaVRhZy50ZXh0Q29udGVudCA9IGAke3Byb2RJdGVtLnRleHRDb250ZW50fSBcXHUwMEEwXFx1MDBBMGA7XHJcbiAgICAgICAgbGlUYWcuZGF0YXNldC52YWx1ZSA9IHByb2RJdGVtLnZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgbGlUYWcuZGF0YXNldC5wZXJjZW50ID0gYWxsU2hvd0xpc3QubGVuZ3RoID09PSAwID8gXCI5MFwiIDogXCIxMFwiO1xyXG4gICAgICAgIGxpVGFnLmFwcGVuZENoaWxkKGlNaW51c1RhZyk7XHJcbiAgICAgICAgbGlUYWcuYXBwZW5kQ2hpbGQoc3BhblRhZyk7XHJcbiAgICAgICAgbGlUYWcuYXBwZW5kQ2hpbGQoaVBsdXNUYWcpO1xyXG5cclxuXHJcbiAgICAgICAgLy9BZGRIaWRkZW4obGlUYWcsIGluZGV4KTtcclxuXHJcbiAgICAgICAgLy8gQWN0aW9uICAgIFxyXG4gICAgICAgIGNvbnN0IHNob3dMaXN0ID0gYWxsU2hvd0xpc3QubGVuZ3RoICUgMiA9PT0gMCA/XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXZlblByb2R1Y3RMc1wiKSA6XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib2RkUHJvZHVjdExzXCIpO1xyXG4gICAgICAgIHNob3dMaXN0Py5hcHBlbmRDaGlsZChsaVRhZyk7XHJcblxyXG4gICAgICAgIGxldCBhbGxTaG93TGlzdDIgPSAkKFwiI2V2ZW5Qcm9kdWN0THMgbGlcIikudG9BcnJheSgpLmNvbmNhdCgkKFwiI29kZFByb2R1Y3RMcyBsaVwiKS50b0FycmF5KCkpXHJcbiAgICAgICAgYWxsU2hvd0xpc3QyLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIEFycmF5LmZyb20oaXRlbS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW5wdXQnKSkuZm9yRWFjaChzdWJJdGVtID0+IHtcclxuICAgICAgICAgICAgICAgIHN1Ykl0ZW0ucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gQWRkSGlkZGVuKGl0ZW0gYXMgSFRNTExJRWxlbWVudCwgaW5kZXgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvL0V2ZW50XHJcbiAgICAgICAgbGV0IHRoaXNPYmogPSB0aGlzO1xyXG4gICAgICAgIGlNaW51c1RhZy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgbGV0IG5vd0xJVGFnID0gdGhpcy5wYXJlbnRFbGVtZW50IGFzIEhUTUxMSUVsZW1lbnQ7XHJcbiAgICAgICAgICAgIHRoaXNPYmouQ2FjdWxhdGVQZXJjZW50KG5vd0xJVGFnLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXNPYmouUmVmcmVzaFByb2RJdGVtUGVyY2VudCgpO1xyXG4gICAgICAgICAgICB0aGlzT2JqLlNob3dUb3RhbEluZm8oKTtcclxuICAgICAgICAgICAgdGhpc09iai5TZXRCaW5kaW5nVmFsdWUoKTtcclxuICAgICAgICAgICAgbGV0IGFsbFNob3dMaXN0MyA9ICQoXCIjZXZlblByb2R1Y3RMcyBsaVwiKS50b0FycmF5KCkuY29uY2F0KCQoXCIjb2RkUHJvZHVjdExzIGxpXCIpLnRvQXJyYXkoKSlcclxuICAgICAgICAgICAgYWxsU2hvd0xpc3QzLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBBcnJheS5mcm9tKGl0ZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2lucHV0JykpLmZvckVhY2goc3ViSXRlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3ViSXRlbS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXNPYmouQWRkSGlkZGVuKGl0ZW0gYXMgSFRNTExJRWxlbWVudCwgaW5kZXgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaVBsdXNUYWcuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGxldCBub3dMSVRhZyA9IHRoaXMucGFyZW50RWxlbWVudCBhcyBIVE1MTElFbGVtZW50XHJcbiAgICAgICAgICAgIHRoaXNPYmouQ2FjdWxhdGVQZXJjZW50KG5vd0xJVGFnLCB0cnVlKTtcclxuICAgICAgICAgICAgdGhpc09iai5SZWZyZXNoUHJvZEl0ZW1QZXJjZW50KCk7XHJcbiAgICAgICAgICAgIHRoaXNPYmouU2hvd1RvdGFsSW5mbygpO1xyXG4gICAgICAgICAgICB0aGlzT2JqLlNldEJpbmRpbmdWYWx1ZSgpO1xyXG4gICAgICAgICAgICBsZXQgYWxsU2hvd0xpc3Q0ID0gJChcIiNldmVuUHJvZHVjdExzIGxpXCIpLnRvQXJyYXkoKS5jb25jYXQoJChcIiNvZGRQcm9kdWN0THMgbGlcIikudG9BcnJheSgpKVxyXG4gICAgICAgICAgICBhbGxTaG93TGlzdDQuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgICAgIEFycmF5LmZyb20oaXRlbS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW5wdXQnKSkuZm9yRWFjaChzdWJJdGVtID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzdWJJdGVtLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpc09iai5BZGRIaWRkZW4oaXRlbSBhcyBIVE1MTElFbGVtZW50LCBpbmRleCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBwdWJsaWMgQXBwZW5kVG9TaG93TGlzdDIocHJvZEl0ZW06IEhUTUxTZWxlY3RFbGVtZW50KSB7XHJcbiAgICB9O1xyXG5cclxuICAgIHB1YmxpYyBSZWZyZXNoUHJvZEl0ZW1QZXJjZW50KCkge1xyXG4gICAgICAgIGxldCBhbGxQcm9kSXRlbXMgPSAkKCcjZXZlblByb2R1Y3RMcyBsaScpLnRvQXJyYXkoKS5jb25jYXQoXHJcbiAgICAgICAgICAgICQoJyNvZGRQcm9kdWN0THMgbGknKS50b0FycmF5KCkpIGFzIEhUTUxMSUVsZW1lbnRbXTtcclxuXHJcbiAgICAgICAgYWxsUHJvZEl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgbGV0IHNwYW5UYWcgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoXCJzcGFuXCIpO1xyXG4gICAgICAgICAgICBzcGFuVGFnLmlubmVySFRNTCA9IGBcXHUwMEEwXFx1MDBBMCR7aXRlbS5kYXRhc2V0LnBlcmNlbnR9JVxcdTAwQTBcXHUwMEEwYFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBBZGRIaWRkZW4odGhlTGk6IEhUTUxMSUVsZW1lbnQsIGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICAvLyBDcmVhdGUgYSBoaWRkZW4gaW5wdXQgZWxlbWVudCwgYW5kIGFwcGVuZCBpdCB0byB0aGUgbGk6XHJcbiAgICAgICAgbGV0IG5hbWVQcm9wZXJ0eSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcclxuICAgICAgICBuYW1lUHJvcGVydHkuY2xhc3NOYW1lID0gXCJtb2RlbGJpbmRcIlxyXG4gICAgICAgIG5hbWVQcm9wZXJ0eS50eXBlID0gXCJoaWRkZW5cIjtcclxuICAgICAgICBuYW1lUHJvcGVydHkubmFtZSA9IGBWRV9QdXJjaGFzZUluZ3JlZGllbnRMc1ske2luZGV4fV0uSXRlbU5hbWVgO1xyXG4gICAgICAgIG5hbWVQcm9wZXJ0eS52YWx1ZSA9IHRoZUxpLmRhdGFzZXQudGV4dFxyXG4gICAgICAgIGxldCB2YWx1ZVByb3BlcnR5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xyXG4gICAgICAgIG5hbWVQcm9wZXJ0eS5jbGFzc05hbWUgPSBcIm1vZGVsYmluZFwiXHJcbiAgICAgICAgdmFsdWVQcm9wZXJ0eS50eXBlID0gXCJoaWRkZW5cIjtcclxuICAgICAgICB2YWx1ZVByb3BlcnR5Lm5hbWUgPSBgVkVfUHVyY2hhc2VJbmdyZWRpZW50THNbJHtpbmRleH1dLlByb2R1Y3RJZGA7XHJcbiAgICAgICAgdmFsdWVQcm9wZXJ0eS52YWx1ZSA9IHRoZUxpLmRhdGFzZXQudmFsdWVcclxuICAgICAgICBsZXQgcGVyY2VudFByb3BlcnR5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xyXG4gICAgICAgIG5hbWVQcm9wZXJ0eS5jbGFzc05hbWUgPSBcIm1vZGVsYmluZFwiXHJcbiAgICAgICAgcGVyY2VudFByb3BlcnR5LnR5cGUgPSBcImhpZGRlblwiO1xyXG4gICAgICAgIHBlcmNlbnRQcm9wZXJ0eS5uYW1lID0gYFZFX1B1cmNoYXNlSW5ncmVkaWVudExzWyR7aW5kZXh9XS5JdGVtUGVyY2VudGA7XHJcbiAgICAgICAgcGVyY2VudFByb3BlcnR5LnZhbHVlID0gdGhlTGkuZGF0YXNldC5wZXJjZW50XHJcblxyXG4gICAgICAgIHRoZUxpLmFwcGVuZENoaWxkKG5hbWVQcm9wZXJ0eSk7XHJcbiAgICAgICAgdGhlTGkuYXBwZW5kQ2hpbGQodmFsdWVQcm9wZXJ0eSk7XHJcbiAgICAgICAgdGhlTGkuYXBwZW5kQ2hpbGQocGVyY2VudFByb3BlcnR5KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgU2hvd1RvdGFsSW5mbygpIHtcclxuICAgICAgICBsZXQgYWxsUHJvZEl0ZW1zID0gJCgnI2V2ZW5Qcm9kdWN0THMgbGknKS50b0FycmF5KCkuY29uY2F0KFxyXG4gICAgICAgICAgICAkKCcjb2RkUHJvZHVjdExzIGxpJykudG9BcnJheSgpKSBhcyBIVE1MTElFbGVtZW50W107XHJcblxyXG4gICAgICAgIGxldCBhbGxQZXJjZW50ID0gMDtcclxuICAgICAgICBsZXQgbWF4SXRlbTogSFRNTExJRWxlbWVudDtcclxuICAgICAgICBhbGxQcm9kSXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICBhbGxQZXJjZW50ID0gKyBpdGVtLmRhdGFzZXQucGVyY2VudCArIGFsbFBlcmNlbnQ7XHJcbiAgICAgICAgICAgIGlmICghbWF4SXRlbSkge1xyXG4gICAgICAgICAgICAgICAgbWF4SXRlbSA9IGl0ZW07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBtYXhJdGVtID0gK21heEl0ZW0uZGF0YXNldC5wZXJjZW50ID4gK2l0ZW0uZGF0YXNldC5wZXJjZW50ID8gbWF4SXRlbSA6IGl0ZW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgdG90YWxJbmZvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0b3RhbFwiKTtcclxuICAgICAgICB0b3RhbEluZm8ucXVlcnlTZWxlY3RvckFsbChcInNwYW5cIikuZm9yRWFjaChpdGVtID0+IHsgaXRlbS5yZW1vdmUoKSB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgaXRlbVNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICBpdGVtU3Bhbi5pbm5lckhUTUwgPSBg77yM5bey6YG4JHthbGxQcm9kSXRlbXMubGVuZ3RofemghWA7XHJcbiAgICAgICAgY29uc3QgcGVyY2VudFNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICBwZXJjZW50U3Bhbi5pbm5lckhUTUwgPSBg77yM5q+U5L6L5Yqg57i9OiR7YWxsUGVyY2VudH0lYFxyXG4gICAgICAgIGlmIChhbGxQZXJjZW50ID4gMTAwKVxyXG4gICAgICAgICAgICBwZXJjZW50U3Bhbi5zdHlsZS5jb2xvciA9IFwicmVkXCI7XHJcbiAgICAgICAgY29uc3QgcmVjb2duaXRpb25TcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcblxyXG4gICAgICAgIC8vbGV0IGhhaGEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VsZWN0MmJzNCA6Y2hlY2tlZCcpIGFzIEhUTUxPcHRpb25FbGVtZW50O1xyXG4gICAgICAgIC8vYWxlcnQoaGFoYS52YWx1ZSk7XHJcblxyXG4gICAgICAgIC8vbGV0IHJlY29nbml0aW9uVGV4dCA9ICgkKCcuc2VsZWN0MmJzNCcpLmZpbmQoJzpzZWxlY3RlZCcpLnRvQXJyYXkoKSBhcyBIVE1MU2VsZWN0RWxlbWVudFtdKVxyXG4gICAgICAgIC8vICAgIC5maWx0ZXIoaXRlbSA9PiB7IHJldHVybiBpdGVtLnZhbHVlID09PSBtYXhJdGVtLmRhdGFzZXQudmFsdWU7IH0pWzBdPy50ZXh0Q29udGVudCA/PyBcIueEoVwiO1xyXG4gICAgICAgIHJlY29nbml0aW9uU3Bhbi5pbm5lckhUTUwgPSBg6KqN5YiX6aCF55uuIDogJHttYXhJdGVtPy5kYXRhc2V0LnRleHQgPz8gXCLnhKFcIn1gXHJcblxyXG4gICAgICAgIHRvdGFsSW5mby5hcHBlbmRDaGlsZChyZWNvZ25pdGlvblNwYW4pO1xyXG4gICAgICAgIHRvdGFsSW5mby5hcHBlbmRDaGlsZChpdGVtU3Bhbik7XHJcbiAgICAgICAgdG90YWxJbmZvLmFwcGVuZENoaWxkKHBlcmNlbnRTcGFuKTtcclxuXHJcbiAgICAgICAgaWYgKGFsbFByb2RJdGVtcy5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAkKCcjSXNQYXNzUHVyY2hhc2UnKS52YWwoXCJ0cnVlXCIpO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgJCgnI0lzUGFzc1B1cmNoYXNlJykudmFsKFwiZmFsc2VcIik7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIFNldEJpbmRpbmdWYWx1ZSgpIHtcclxuXHJcbiAgICAgICAgbGV0IGFsbFByb2RJdGVtcyA9ICQoJyNldmVuUHJvZHVjdExzIGxpJykudG9BcnJheSgpLmNvbmNhdChcclxuICAgICAgICAgICAgJCgnI29kZFByb2R1Y3RMcyBsaScpLnRvQXJyYXkoKSkgYXMgSFRNTExJRWxlbWVudFtdO1xyXG5cclxuICAgICAgICBsZXQgcHVyY2hhc2VEZXRhaWxJbmZvczogUHVyY2hhc2VEZXRhaWxJbmZvMltdID0gW107XHJcbiAgICAgICAgYWxsUHJvZEl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgbGV0IHB1cmNoYXNlRGV0YWlsSW5mbyA9IG5ldyBQdXJjaGFzZURldGFpbEluZm8yKCk7XHJcbiAgICAgICAgICAgIHB1cmNoYXNlRGV0YWlsSW5mby5WYWx1ZSA9IGl0ZW0uZGF0YXNldC52YWx1ZTtcclxuICAgICAgICAgICAgcHVyY2hhc2VEZXRhaWxJbmZvLk5hbWUgPSBpdGVtLnRleHRDb250ZW50O1xyXG4gICAgICAgICAgICBwdXJjaGFzZURldGFpbEluZm8uUGVyY2VudCA9IHBhcnNlSW50KGl0ZW0uZGF0YXNldC5wZXJjZW50LCAxMCk7XHJcbiAgICAgICAgICAgIHB1cmNoYXNlRGV0YWlsSW5mb3MucHVzaChwdXJjaGFzZURldGFpbEluZm8pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChwdXJjaGFzZURldGFpbEluZm9zLmxlbmd0aCA9PT0gMClcclxuICAgICAgICAgICAgJCgnI1NlbGVjdFB1cmNoYXNlRGV0YWlsSW5mb3MnKS52YWwobnVsbCk7XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICQoJyNTZWxlY3RQdXJjaGFzZURldGFpbEluZm9zJykudmFsKEpTT04uc3RyaW5naWZ5KHB1cmNoYXNlRGV0YWlsSW5mb3MpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBDYWN1bGF0ZVBlcmNlbnQoY3VyUHJvZEl0ZW06IEhUTUxMSUVsZW1lbnQsIGlzUGx1czogYm9vbGVhbikge1xyXG4gICAgICAgIGNvbnN0IGN1clZhbCA9IGN1clByb2RJdGVtLmRhdGFzZXQucGVyY2VudDtcclxuICAgICAgICBsZXQgbmV3VmFsOiBudW1iZXIgPSBpc1BsdXMgPyArY3VyVmFsICsgMTAgOiArY3VyVmFsIC0gMTA7XHJcbiAgICAgICAgaWYgKG5ld1ZhbCA+IDEwMClcclxuICAgICAgICAgICAgbmV3VmFsID0gMTAwO1xyXG4gICAgICAgIGlmIChuZXdWYWwgPCAwKVxyXG4gICAgICAgICAgICBuZXdWYWwgPSAwO1xyXG4gICAgICAgIGN1clByb2RJdGVtLmRhdGFzZXQucGVyY2VudCA9IG5ld1ZhbC50b1N0cmluZygpO1xyXG4gICAgICAgIC8vdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvdXRzaWRlXCIpO1xyXG4gICAgICAgIC8vZWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIG1vZGlmeVRleHQsIGZhbHNlKTtcclxuICAgIH1cclxufTtcclxuXHJcbmNsYXNzIFB1cmNoYXNlRGV0YWlsSW5mbzIge1xyXG4gICAgVmFsdWU6IHN0cmluZztcclxuICAgIE5hbWU6IHN0cmluZztcclxuICAgIFBlcmNlbnQ6IG51bWJlcjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIH1cclxufVxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4iXX0=