var CreateWeightNotePage_Main = /** @class */ (function () {
    function CreateWeightNotePage_Main(baseUrl) {
        if (baseUrl === void 0) { baseUrl = ""; }
        this.BaseUrl = baseUrl;
        this.ProdList = new CreateWeightNotePage_ProdList("evenProductLs", "oddProductLs");
    }
    CreateWeightNotePage_Main.prototype.IniPageEvent = function () {
        // Page Field
        var fullWeight = $('#VE_PurchaseWeightNote_FullWeightTime').get(0);
        var defectiveWeight = $('#VE_PurchaseWeightNote_DefectiveWeight').get(0);
        var unitPrice = $('#VE_PurchaseWeightNote_UnitPrice').get(0);
        var traficUnitPrice = $('#VE_PurchaseWeightNote_TraficUnitPrice').get(0);
        var weightFee = $('#VE_PurchaseWeightNote_ThirdWeightFee').get(0);
        var ishasTaxList = $(".ishas_tax").get();
        // Logic        
        //fullWeight.addEventListener('keyup', this.CaculateAllFee);
        //defectiveWeight.addEventListener('keyup', this.CaculateAllFee);
        //unitPrice.addEventListener('keyup', this.CaculateAllFee);
        //traficUnitPrice.addEventListener('keyup', this.CaculateAllFee);
        //weightFee.addEventListener('keyup', this.CaculateAllFee);
        //ishasTaxList.forEach((item) => item.addEventListener('change', this.CaculateAllFee));
    };
    ;
    return CreateWeightNotePage_Main;
}());
;
var CreateWeightNotePage_Main2 = /** @class */ (function () {
    function CreateWeightNotePage_Main2(baseUrl) {
        if (baseUrl === void 0) { baseUrl = ""; }
        // Page  Dom
        this.EvenULDom = $('#evenProductLs').get(0);
        this.OddLULDom = $('#oddProductLs').get(0);
        // Porperites
        this._prodItemList = [];
        this.BaseUrl = baseUrl;
    }
    CreateWeightNotePage_Main2.prototype.ShowUSProdItems = function () {
        var _this = this;
        this.EvenULDom.innerHTML = "";
        this.OddLULDom.innerHTML = "";
        this._prodItemList.forEach(function (item, index) {
            var iMinusTag = document.createElement("i");
            iMinusTag.classList.add("fas");
            iMinusTag.classList.add("fa-minus-circle");
            iMinusTag.style.cursor = "pointer";
            iMinusTag.style.color = "blue";
            var iPlusTag = document.createElement("i");
            iPlusTag.classList.add("fas");
            iPlusTag.classList.add("fa-plus-circle");
            iPlusTag.style.cursor = "pointer";
            iPlusTag.style.color = "red";
            var spanTag = document.createElement("span");
            var liTag = document.createElement("li");
            liTag.dataset.text = item.prodText;
            liTag.textContent = item.prodText + " \u00A0\u00A0";
            liTag.dataset.value = item.prodId;
            // liTag.dataset.percent = this._prodItemList.length === 0 ? "90" : "10";
            spanTag.innerHTML = "\u00A0\u00A0" + item.percent + "%\u00A0\u00A0";
            liTag.appendChild(iMinusTag);
            liTag.appendChild(spanTag);
            liTag.appendChild(iPlusTag);
            index % 2 === 0 ? _this.EvenULDom.appendChild(liTag) :
                _this.OddLULDom.appendChild(liTag);
        });
    };
    CreateWeightNotePage_Main2.prototype.Append = function (prodId, prodText) {
        var isItemExist = this._prodItemList.filter(function (item) { return item.prodId === prodId; }).length > 0;
        if (!isItemExist) {
            var prodItem = new PurchaseProdItem(prodId, prodText, this._prodItemList.length === 0 ? 90 : 10);
            this._prodItemList.push(prodItem);
        }
    };
    return CreateWeightNotePage_Main2;
}());
;
var PurchaseProdItem = /** @class */ (function () {
    function PurchaseProdItem(prodId, prodText, percent) {
        this.prodId = prodId;
        this.prodText = prodText;
        this.percent = percent;
    }
    return PurchaseProdItem;
}());
var CreateWeightNotePage_ProdList = /** @class */ (function () {
    function CreateWeightNotePage_ProdList(evenListId, oddListId) {
        this.CalPercentClassName = "testHaha";
        this.EvenListJQueryObj = $("#" + evenListId);
        this.EvenListHtmlObj = this.EvenListJQueryObj.get(0);
        this.OddListJQueryObj = $("#" + oddListId);
        this.OddListHtmlObj = this.OddListJQueryObj.get(0);
        this.AllProdItemLs = this.EvenListJQueryObj.find('li').toArray().concat(this.OddListJQueryObj.find('li').toArray());
    }
    CreateWeightNotePage_ProdList.prototype.Show = function () {
        var _this = this;
        this.EvenListHtmlObj.innerHTML = "";
        this.OddListHtmlObj.innerHTML = "";
        this.AllProdItemLs.forEach(function (item, index) {
            index % 2 === 0 ? _this.EvenListHtmlObj.appendChild(item) :
                _this.OddListHtmlObj.appendChild(item);
        });
    };
    CreateWeightNotePage_ProdList.prototype.Append = function (prodItemVal, prodItemText) {
        var thisObj = this;
        //alert(this.EvenListHtmlObj.id);
        //alert(this.OddListHtmlObj.id);
        //let evenLiTags = this.EvenListJQueryObj.find('li').toArray();
        //let oddLiTags = this.OddListJQueryObj.find('li').toArray();
        ////// $("#oddProductLs li").toArray()
        //const allShowLiTags = evenLiTags.concat(oddLiTags);
        //if (allShowLiTags)
        //    alert(allShowLiTags.map(item => { return item.dataset.value }))
        var isItemExist = this.AllProdItemLs.filter(function (item) { return item.dataset.value === prodItemVal; }).length > 0;
        if (!isItemExist) {
            var iMinusTag = document.createElement("i");
            iMinusTag.classList.add("fas");
            iMinusTag.classList.add("fa-minus-circle");
            iMinusTag.classList.add(this.CalPercentClassName);
            iMinusTag.style.cursor = "pointer";
            iMinusTag.style.color = "blue";
            var iPlusTag = document.createElement("i");
            iPlusTag.classList.add("fas");
            iPlusTag.classList.add("fa-plus-circle");
            iPlusTag.classList.add(this.CalPercentClassName);
            iPlusTag.style.cursor = "pointer";
            iPlusTag.style.color = "red";
            var spanTag = document.createElement("span");
            var liTag = document.createElement("li");
            liTag.dataset.text = prodItemText;
            liTag.textContent = prodItemText + " \u00A0\u00A0";
            liTag.dataset.value = prodItemVal;
            liTag.dataset.percent = this.AllProdItemLs.length === 0 ? "90" : "10";
            spanTag.innerHTML = thisObj.GetPercentResult(liTag.dataset.percent); // new
            liTag.appendChild(iMinusTag);
            liTag.appendChild(spanTag);
            liTag.appendChild(iPlusTag);
            //Event  下面的事件要拉到主頁去做  2個事件
            iMinusTag.addEventListener('click', function () {
                var nowLITag = this.parentElement;
                var newPercent = +nowLITag.dataset.percent - 10;
                nowLITag.dataset.percent = newPercent < 0 ? "0" : newPercent.toString();
                var spanTag = nowLITag.querySelector("span");
                spanTag.innerHTML = thisObj.GetPercentResult(nowLITag.dataset.percent);
                //thisObj.RefreshProdItemPercent();
                //thisObj.ShowTotalInfo();
                //thisObj.SetBindingValue();        在完成這個         
            });
            iPlusTag.addEventListener('click', function () {
                var nowLITag = this.parentElement;
                var newPercent = +nowLITag.dataset.percent + 10;
                nowLITag.dataset.percent = newPercent > 100 ? "100" : newPercent.toString();
                var spanTag = nowLITag.querySelector("span");
                spanTag.innerHTML = thisObj.GetPercentResult(nowLITag.dataset.percent);
                //thisObj.RefreshProdItemPercent();
                //thisObj.ShowTotalInfo();  // 變成取得字串資訊的方法
                //thisObj.SetBindingValue();  // 變成回傳input tag集合 然後再上層自行決定加在哪個Tag
            });
            // Action    
            this.AllProdItemLs.push(liTag);
        }
    };
    CreateWeightNotePage_ProdList.prototype.GetPercentResult = function (percentStr) {
        return "\u00A0\u00A0" + percentStr + "%\u00A0\u00A0";
    };
    CreateWeightNotePage_ProdList.prototype.Remove = function (prodItemVal) {
        var wRemoveItem = this.AllProdItemLs.find(function (item) { return item.dataset.value === prodItemVal; });
        this.AllProdItemLs.splice(this.AllProdItemLs.indexOf(wRemoveItem), 1);
    };
    CreateWeightNotePage_ProdList.prototype.RefreshProdItemPercent = function () {
        this.AllProdItemLs.forEach(function (item) {
            var spanTag = item.querySelector("span");
            spanTag.innerHTML = "\u00A0\u00A0" + item.dataset.percent + "%\u00A0\u00A0";
        });
    };
    CreateWeightNotePage_ProdList.prototype.GetTotalInfoMsg = function () {
        var _a;
        var allPercent = 0;
        var maxItem;
        this.AllProdItemLs.forEach(function (item) {
            allPercent = +item.dataset.percent + allPercent;
            if (!maxItem) {
                maxItem = item;
            }
            else {
                maxItem = +maxItem.dataset.percent > +item.dataset.percent ? maxItem : item;
            }
        });
        var itemSpan = document.createElement("span");
        itemSpan.innerHTML = "\uFF0C\u5DF2\u9078" + this.AllProdItemLs.length + "\u9805";
        var percentSpan = document.createElement("span");
        percentSpan.innerHTML = "\uFF0C\u6BD4\u4F8B\u52A0\u7E3D:" + allPercent + "%";
        if (allPercent > 100)
            percentSpan.style.color = "red";
        var recognitionSpan = document.createElement("span");
        recognitionSpan.innerHTML = "\u8A8D\u5217\u9805\u76EE : " + ((_a = maxItem === null || maxItem === void 0 ? void 0 : maxItem.dataset.text) !== null && _a !== void 0 ? _a : "無");
        return "" + recognitionSpan.innerHTML + itemSpan.innerHTML + percentSpan.innerHTML;
        //if (this.AllProdItemLs.length > 0)
        //    $('#IsPassPurchase').val("true");
        //else
        //    $('#IsPassPurchase').val("false");
    };
    return CreateWeightNotePage_ProdList;
}());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ3JlYXRlV2VpZ2h0Tm90ZTIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zY3JpcHRzL0NyZWF0ZVdlaWdodE5vdGUyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0lBUUksbUNBQVksT0FBb0I7UUFBcEIsd0JBQUEsRUFBQSxZQUFvQjtRQUM1QixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksNkJBQTZCLENBQUMsZUFBZSxFQUFFLGNBQWMsQ0FBQyxDQUFDO0lBQ3ZGLENBQUM7SUFHTSxnREFBWSxHQUFuQjtRQUNJLGFBQWE7UUFDYixJQUFJLFVBQVUsR0FBRyxDQUFDLENBQUMsdUNBQXVDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkUsSUFBSSxlQUFlLEdBQUcsQ0FBQyxDQUFDLHdDQUF3QyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3pFLElBQUksU0FBUyxHQUFHLENBQUMsQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM3RCxJQUFJLGVBQWUsR0FBRyxDQUFDLENBQUMsd0NBQXdDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekUsSUFBSSxTQUFTLEdBQUcsQ0FBQyxDQUFDLHVDQUF1QyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xFLElBQUksWUFBWSxHQUFHLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUV6QyxnQkFBZ0I7UUFDaEIsNERBQTREO1FBQzVELGlFQUFpRTtRQUNqRSwyREFBMkQ7UUFDM0QsaUVBQWlFO1FBQ2pFLDJEQUEyRDtRQUMzRCx1RkFBdUY7SUFDM0YsQ0FBQztJQUFBLENBQUM7SUFHTixnQ0FBQztBQUFELENBQUMsQUFqQ0QsSUFpQ0M7QUFBQSxDQUFDO0FB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d0NBQXdDO0lBQzVDLENBQUM7SUFDTCxvQ0FBQztBQUFELENBQUMsQUEzSkQsSUEySkMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBDcmVhdGVXZWlnaHROb3RlUGFnZV9NYWluIHtcclxuICAgIC8vIFBvcnBlcml0ZXNcclxuICAgIHB1YmxpYyBQcm9kTGlzdDogQ3JlYXRlV2VpZ2h0Tm90ZVBhZ2VfUHJvZExpc3Q7XHJcblxyXG5cclxuXHJcblxyXG4gICAgQmFzZVVybDogc3RyaW5nO1xyXG4gICAgY29uc3RydWN0b3IoYmFzZVVybDogc3RyaW5nID0gXCJcIikge1xyXG4gICAgICAgIHRoaXMuQmFzZVVybCA9IGJhc2VVcmw7XHJcbiAgICAgICAgdGhpcy5Qcm9kTGlzdCA9IG5ldyBDcmVhdGVXZWlnaHROb3RlUGFnZV9Qcm9kTGlzdChcImV2ZW5Qcm9kdWN0THNcIiwgXCJvZGRQcm9kdWN0THNcIik7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyBJbmlQYWdlRXZlbnQoKSB7XHJcbiAgICAgICAgLy8gUGFnZSBGaWVsZFxyXG4gICAgICAgIGxldCBmdWxsV2VpZ2h0ID0gJCgnI1ZFX1B1cmNoYXNlV2VpZ2h0Tm90ZV9GdWxsV2VpZ2h0VGltZScpLmdldCgwKTtcclxuICAgICAgICBsZXQgZGVmZWN0aXZlV2VpZ2h0ID0gJCgnI1ZFX1B1cmNoYXNlV2VpZ2h0Tm90ZV9EZWZlY3RpdmVXZWlnaHQnKS5nZXQoMCk7XHJcbiAgICAgICAgbGV0IHVuaXRQcmljZSA9ICQoJyNWRV9QdXJjaGFzZVdlaWdodE5vdGVfVW5pdFByaWNlJykuZ2V0KDApO1xyXG4gICAgICAgIGxldCB0cmFmaWNVbml0UHJpY2UgPSAkKCcjVkVfUHVyY2hhc2VXZWlnaHROb3RlX1RyYWZpY1VuaXRQcmljZScpLmdldCgwKTtcclxuICAgICAgICBsZXQgd2VpZ2h0RmVlID0gJCgnI1ZFX1B1cmNoYXNlV2VpZ2h0Tm90ZV9UaGlyZFdlaWdodEZlZScpLmdldCgwKTtcclxuICAgICAgICBsZXQgaXNoYXNUYXhMaXN0ID0gJChcIi5pc2hhc190YXhcIikuZ2V0KCk7XHJcblxyXG4gICAgICAgIC8vIExvZ2ljICAgICAgICBcclxuICAgICAgICAvL2Z1bGxXZWlnaHQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLkNhY3VsYXRlQWxsRmVlKTtcclxuICAgICAgICAvL2RlZmVjdGl2ZVdlaWdodC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRoaXMuQ2FjdWxhdGVBbGxGZWUpO1xyXG4gICAgICAgIC8vdW5pdFByaWNlLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5DYWN1bGF0ZUFsbEZlZSk7XHJcbiAgICAgICAgLy90cmFmaWNVbml0UHJpY2UuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLkNhY3VsYXRlQWxsRmVlKTtcclxuICAgICAgICAvL3dlaWdodEZlZS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRoaXMuQ2FjdWxhdGVBbGxGZWUpO1xyXG4gICAgICAgIC8vaXNoYXNUYXhMaXN0LmZvckVhY2goKGl0ZW0pID0+IGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdGhpcy5DYWN1bGF0ZUFsbEZlZSkpO1xyXG4gICAgfTtcclxuXHJcblxyXG59O1xyXG5cclxuY2xhc3MgQ3JlYXRlV2VpZ2h0Tm90ZVBhZ2VfTWFpbjIge1xyXG4gICAgLy8gUGFnZSAgRG9tXHJcbiAgICBwdWJsaWMgRXZlblVMRG9tOiBIVE1MVUxpc3RFbGVtZW50ID0gJCgnI2V2ZW5Qcm9kdWN0THMnKS5nZXQoMCkgYXMgSFRNTFVMaXN0RWxlbWVudDtcclxuICAgIHB1YmxpYyBPZGRMVUxEb206IEhUTUxVTGlzdEVsZW1lbnQgPSAkKCcjb2RkUHJvZHVjdExzJykuZ2V0KDApIGFzIEhUTUxVTGlzdEVsZW1lbnQ7XHJcblxyXG5cclxuICAgIC8vIFBvcnBlcml0ZXNcclxuICAgIHByaXZhdGUgX3Byb2RJdGVtTGlzdDogUHVyY2hhc2VQcm9kSXRlbVtdID0gW107XHJcblxyXG5cclxuXHJcblxyXG5cclxuICAgIEJhc2VVcmw6IHN0cmluZztcclxuICAgIGNvbnN0cnVjdG9yKGJhc2VVcmw6IHN0cmluZyA9IFwiXCIpIHtcclxuICAgICAgICB0aGlzLkJhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBTaG93VVNQcm9kSXRlbXMoKSB7XHJcbiAgICAgICAgdGhpcy5FdmVuVUxEb20uaW5uZXJIVE1MID0gXCJcIjtcclxuICAgICAgICB0aGlzLk9kZExVTERvbS5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgICAgIHRoaXMuX3Byb2RJdGVtTGlzdC5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgY29uc3QgaU1pbnVzVGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlcIik7XHJcbiAgICAgICAgICAgIGlNaW51c1RhZy5jbGFzc0xpc3QuYWRkKFwiZmFzXCIpO1xyXG4gICAgICAgICAgICBpTWludXNUYWcuY2xhc3NMaXN0LmFkZChcImZhLW1pbnVzLWNpcmNsZVwiKTtcclxuICAgICAgICAgICAgaU1pbnVzVGFnLnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiO1xyXG4gICAgICAgICAgICBpTWludXNUYWcuc3R5bGUuY29sb3IgPSBcImJsdWVcIjtcclxuICAgICAgICAgICAgY29uc3QgaVBsdXNUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaVwiKTtcclxuICAgICAgICAgICAgaVBsdXNUYWcuY2xhc3NMaXN0LmFkZChcImZhc1wiKTtcclxuICAgICAgICAgICAgaVBsdXNUYWcuY2xhc3NMaXN0LmFkZChcImZhLXBsdXMtY2lyY2xlXCIpO1xyXG4gICAgICAgICAgICBpUGx1c1RhZy5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcclxuICAgICAgICAgICAgaVBsdXNUYWcuc3R5bGUuY29sb3IgPSBcInJlZFwiO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3BhblRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpIGFzIEhUTUxTcGFuRWxlbWVudDtcclxuICAgICAgICAgICAgY29uc3QgbGlUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIikgYXMgSFRNTExJRWxlbWVudDtcclxuICAgICAgICAgICAgbGlUYWcuZGF0YXNldC50ZXh0ID0gaXRlbS5wcm9kVGV4dDtcclxuICAgICAgICAgICAgbGlUYWcudGV4dENvbnRlbnQgPSBgJHtpdGVtLnByb2RUZXh0fSBcXHUwMEEwXFx1MDBBMGA7XHJcbiAgICAgICAgICAgIGxpVGFnLmRhdGFzZXQudmFsdWUgPSBpdGVtLnByb2RJZDtcclxuICAgICAgICAgICAgLy8gbGlUYWcuZGF0YXNldC5wZXJjZW50ID0gdGhpcy5fcHJvZEl0ZW1MaXN0Lmxlbmd0aCA9PT0gMCA/IFwiOTBcIiA6IFwiMTBcIjtcclxuICAgICAgICAgICAgc3BhblRhZy5pbm5lckhUTUwgPSBgXFx1MDBBMFxcdTAwQTAke2l0ZW0ucGVyY2VudH0lXFx1MDBBMFxcdTAwQTBgO1xyXG4gICAgICAgICAgICBsaVRhZy5hcHBlbmRDaGlsZChpTWludXNUYWcpO1xyXG4gICAgICAgICAgICBsaVRhZy5hcHBlbmRDaGlsZChzcGFuVGFnKTtcclxuICAgICAgICAgICAgbGlUYWcuYXBwZW5kQ2hpbGQoaVBsdXNUYWcpO1xyXG5cclxuICAgICAgICAgICAgaW5kZXggJSAyID09PSAwID8gdGhpcy5FdmVuVUxEb20uYXBwZW5kQ2hpbGQobGlUYWcpIDpcclxuICAgICAgICAgICAgICAgIHRoaXMuT2RkTFVMRG9tLmFwcGVuZENoaWxkKGxpVGFnKVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIEFwcGVuZChwcm9kSWQ6IHN0cmluZywgcHJvZFRleHQ6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGlzSXRlbUV4aXN0ID0gdGhpcy5fcHJvZEl0ZW1MaXN0LmZpbHRlcihpdGVtID0+IGl0ZW0ucHJvZElkID09PSBwcm9kSWQpLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgaWYgKCFpc0l0ZW1FeGlzdCkge1xyXG4gICAgICAgICAgICBsZXQgcHJvZEl0ZW0gPSBuZXcgUHVyY2hhc2VQcm9kSXRlbShwcm9kSWQsIHByb2RUZXh0LCB0aGlzLl9wcm9kSXRlbUxpc3QubGVuZ3RoID09PSAwID8gOTAgOiAxMCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3Byb2RJdGVtTGlzdC5wdXNoKHByb2RJdGVtKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxufTtcclxuXHJcbmNsYXNzIFB1cmNoYXNlUHJvZEl0ZW0ge1xyXG4gICAgcmVhZG9ubHkgcHJvZElkOiBzdHJpbmc7XHJcbiAgICByZWFkb25seSBwcm9kVGV4dDogc3RyaW5nO1xyXG4gICAgcmVhZG9ubHkgcGVyY2VudDogbnVtYmVyO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByb2RJZDogc3RyaW5nLCBwcm9kVGV4dDogc3RyaW5nLCBwZXJjZW50OiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLnByb2RJZCA9IHByb2RJZDtcclxuICAgICAgICB0aGlzLnByb2RUZXh0ID0gcHJvZFRleHQ7XHJcbiAgICAgICAgdGhpcy5wZXJjZW50ID0gcGVyY2VudDtcclxuICAgIH1cclxuXHJcblxyXG59XHJcblxyXG5cclxuY2xhc3MgQ3JlYXRlV2VpZ2h0Tm90ZVBhZ2VfUHJvZExpc3Qge1xyXG4gICAgcHVibGljIEV2ZW5MaXN0SHRtbE9iajogSFRNTFVMaXN0RWxlbWVudDtcclxuICAgIHB1YmxpYyBFdmVuTGlzdEpRdWVyeU9iajogSlF1ZXJ5PEhUTUxVTGlzdEVsZW1lbnQ+O1xyXG4gICAgcHVibGljIE9kZExpc3RIdG1sT2JqOiBIVE1MVUxpc3RFbGVtZW50O1xyXG4gICAgcHVibGljIE9kZExpc3RKUXVlcnlPYmo6IEpRdWVyeTxIVE1MVUxpc3RFbGVtZW50PjtcclxuICAgIHByaXZhdGUgQWxsUHJvZEl0ZW1MczogSFRNTExJRWxlbWVudFtdO1xyXG4gICAgcmVhZG9ubHkgQ2FsUGVyY2VudENsYXNzTmFtZTogc3RyaW5nID0gXCJ0ZXN0SGFoYVwiO1xyXG5cclxuXHJcbiAgICBjb25zdHJ1Y3RvcihldmVuTGlzdElkOiBzdHJpbmcsIG9kZExpc3RJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5FdmVuTGlzdEpRdWVyeU9iaiA9ICQoYCMke2V2ZW5MaXN0SWR9YClcclxuICAgICAgICB0aGlzLkV2ZW5MaXN0SHRtbE9iaiA9IHRoaXMuRXZlbkxpc3RKUXVlcnlPYmouZ2V0KDApO1xyXG4gICAgICAgIHRoaXMuT2RkTGlzdEpRdWVyeU9iaiA9ICQoYCMke29kZExpc3RJZH1gKVxyXG4gICAgICAgIHRoaXMuT2RkTGlzdEh0bWxPYmogPSB0aGlzLk9kZExpc3RKUXVlcnlPYmouZ2V0KDApO1xyXG4gICAgICAgIHRoaXMuQWxsUHJvZEl0ZW1McyA9IHRoaXMuRXZlbkxpc3RKUXVlcnlPYmouZmluZCgnbGknKS50b0FycmF5KCkuY29uY2F0KFxyXG4gICAgICAgICAgICB0aGlzLk9kZExpc3RKUXVlcnlPYmouZmluZCgnbGknKS50b0FycmF5KCkpXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIFNob3coKSB7XHJcbiAgICAgICAgdGhpcy5FdmVuTGlzdEh0bWxPYmouaW5uZXJIVE1MID0gXCJcIjtcclxuICAgICAgICB0aGlzLk9kZExpc3RIdG1sT2JqLmlubmVySFRNTCA9IFwiXCI7XHJcbiAgICAgICAgdGhpcy5BbGxQcm9kSXRlbUxzLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGluZGV4ICUgMiA9PT0gMCA/IHRoaXMuRXZlbkxpc3RIdG1sT2JqLmFwcGVuZENoaWxkKGl0ZW0pIDpcclxuICAgICAgICAgICAgICAgIHRoaXMuT2RkTGlzdEh0bWxPYmouYXBwZW5kQ2hpbGQoaXRlbSlcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwdWJsaWMgQXBwZW5kKHByb2RJdGVtVmFsOiBzdHJpbmcsIHByb2RJdGVtVGV4dDogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IHRoaXNPYmogPSB0aGlzO1xyXG4gICAgICAgIC8vYWxlcnQodGhpcy5FdmVuTGlzdEh0bWxPYmouaWQpO1xyXG4gICAgICAgIC8vYWxlcnQodGhpcy5PZGRMaXN0SHRtbE9iai5pZCk7XHJcblxyXG4gICAgICAgIC8vbGV0IGV2ZW5MaVRhZ3MgPSB0aGlzLkV2ZW5MaXN0SlF1ZXJ5T2JqLmZpbmQoJ2xpJykudG9BcnJheSgpO1xyXG4gICAgICAgIC8vbGV0IG9kZExpVGFncyA9IHRoaXMuT2RkTGlzdEpRdWVyeU9iai5maW5kKCdsaScpLnRvQXJyYXkoKTtcclxuXHJcbiAgICAgICAgLy8vLy8vICQoXCIjb2RkUHJvZHVjdExzIGxpXCIpLnRvQXJyYXkoKVxyXG4gICAgICAgIC8vY29uc3QgYWxsU2hvd0xpVGFncyA9IGV2ZW5MaVRhZ3MuY29uY2F0KG9kZExpVGFncyk7XHJcblxyXG4gICAgICAgIC8vaWYgKGFsbFNob3dMaVRhZ3MpXHJcbiAgICAgICAgLy8gICAgYWxlcnQoYWxsU2hvd0xpVGFncy5tYXAoaXRlbSA9PiB7IHJldHVybiBpdGVtLmRhdGFzZXQudmFsdWUgfSkpXHJcblxyXG4gICAgICAgIGNvbnN0IGlzSXRlbUV4aXN0ID0gdGhpcy5BbGxQcm9kSXRlbUxzLmZpbHRlcihpdGVtID0+IGl0ZW0uZGF0YXNldC52YWx1ZSA9PT0gcHJvZEl0ZW1WYWwpLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgaWYgKCFpc0l0ZW1FeGlzdCkge1xyXG4gICAgICAgICAgICBjb25zdCBpTWludXNUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaVwiKTtcclxuICAgICAgICAgICAgaU1pbnVzVGFnLmNsYXNzTGlzdC5hZGQoXCJmYXNcIik7XHJcbiAgICAgICAgICAgIGlNaW51c1RhZy5jbGFzc0xpc3QuYWRkKFwiZmEtbWludXMtY2lyY2xlXCIpO1xyXG4gICAgICAgICAgICBpTWludXNUYWcuY2xhc3NMaXN0LmFkZCh0aGlzLkNhbFBlcmNlbnRDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICBpTWludXNUYWcuc3R5bGUuY3Vyc29yID0gXCJwb2ludGVyXCI7XHJcbiAgICAgICAgICAgIGlNaW51c1RhZy5zdHlsZS5jb2xvciA9IFwiYmx1ZVwiO1xyXG4gICAgICAgICAgICBjb25zdCBpUGx1c1RhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpXCIpO1xyXG4gICAgICAgICAgICBpUGx1c1RhZy5jbGFzc0xpc3QuYWRkKFwiZmFzXCIpO1xyXG4gICAgICAgICAgICBpUGx1c1RhZy5jbGFzc0xpc3QuYWRkKFwiZmEtcGx1cy1jaXJjbGVcIik7XHJcbiAgICAgICAgICAgIGlQbHVzVGFnLmNsYXNzTGlzdC5hZGQodGhpcy5DYWxQZXJjZW50Q2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgaVBsdXNUYWcuc3R5bGUuY3Vyc29yID0gXCJwb2ludGVyXCI7XHJcbiAgICAgICAgICAgIGlQbHVzVGFnLnN0eWxlLmNvbG9yID0gXCJyZWRcIjtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHNwYW5UYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKSBhcyBIVE1MU3BhbkVsZW1lbnQ7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpVGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpXCIpIGFzIEhUTUxMSUVsZW1lbnQ7XHJcbiAgICAgICAgICAgIGxpVGFnLmRhdGFzZXQudGV4dCA9IHByb2RJdGVtVGV4dDtcclxuICAgICAgICAgICAgbGlUYWcudGV4dENvbnRlbnQgPSBgJHtwcm9kSXRlbVRleHR9IFxcdTAwQTBcXHUwMEEwYDtcclxuICAgICAgICAgICAgbGlUYWcuZGF0YXNldC52YWx1ZSA9IHByb2RJdGVtVmFsO1xyXG4gICAgICAgICAgICBsaVRhZy5kYXRhc2V0LnBlcmNlbnQgPSB0aGlzLkFsbFByb2RJdGVtTHMubGVuZ3RoID09PSAwID8gXCI5MFwiIDogXCIxMFwiO1xyXG4gICAgICAgICAgICBzcGFuVGFnLmlubmVySFRNTCA9IHRoaXNPYmouR2V0UGVyY2VudFJlc3VsdChsaVRhZy5kYXRhc2V0LnBlcmNlbnQpICAvLyBuZXdcclxuICAgICAgICAgICAgbGlUYWcuYXBwZW5kQ2hpbGQoaU1pbnVzVGFnKTtcclxuICAgICAgICAgICAgbGlUYWcuYXBwZW5kQ2hpbGQoc3BhblRhZyk7XHJcbiAgICAgICAgICAgIGxpVGFnLmFwcGVuZENoaWxkKGlQbHVzVGFnKTtcclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIC8vRXZlbnQgIOS4i+mdoueahOS6i+S7tuimgeaLieWIsOS4u+mggeWOu+WBmiAgMuWAi+S6i+S7tlxyXG5cclxuICAgICAgICAgICAgaU1pbnVzVGFnLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IG5vd0xJVGFnID0gdGhpcy5wYXJlbnRFbGVtZW50IGFzIEhUTUxMSUVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICBsZXQgbmV3UGVyY2VudDogbnVtYmVyID0gK25vd0xJVGFnLmRhdGFzZXQucGVyY2VudCAtIDEwO1xyXG4gICAgICAgICAgICAgICAgbm93TElUYWcuZGF0YXNldC5wZXJjZW50ID0gbmV3UGVyY2VudCA8IDAgPyBcIjBcIiA6IG5ld1BlcmNlbnQudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgIGxldCBzcGFuVGFnID0gbm93TElUYWcucXVlcnlTZWxlY3RvcihcInNwYW5cIik7XHJcbiAgICAgICAgICAgICAgICBzcGFuVGFnLmlubmVySFRNTCA9IHRoaXNPYmouR2V0UGVyY2VudFJlc3VsdChub3dMSVRhZy5kYXRhc2V0LnBlcmNlbnQpO1xyXG4gICAgICAgICAgICAgICAgLy90aGlzT2JqLlJlZnJlc2hQcm9kSXRlbVBlcmNlbnQoKTtcclxuICAgICAgICAgICAgICAgIC8vdGhpc09iai5TaG93VG90YWxJbmZvKCk7XHJcbiAgICAgICAgICAgICAgICAvL3RoaXNPYmouU2V0QmluZGluZ1ZhbHVlKCk7ICAgICAgICDlnKjlrozmiJDpgJnlgIsgICAgICAgICBcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpUGx1c1RhZy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGxldCBub3dMSVRhZyA9IHRoaXMucGFyZW50RWxlbWVudCBhcyBIVE1MTElFbGVtZW50O1xyXG4gICAgICAgICAgICAgICAgbGV0IG5ld1BlcmNlbnQ6IG51bWJlciA9ICtub3dMSVRhZy5kYXRhc2V0LnBlcmNlbnQgKyAxMDtcclxuICAgICAgICAgICAgICAgIG5vd0xJVGFnLmRhdGFzZXQucGVyY2VudCA9IG5ld1BlcmNlbnQgPiAxMDAgPyBcIjEwMFwiIDogbmV3UGVyY2VudC50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHNwYW5UYWcgPSBub3dMSVRhZy5xdWVyeVNlbGVjdG9yKFwic3BhblwiKTtcclxuICAgICAgICAgICAgICAgIHNwYW5UYWcuaW5uZXJIVE1MID0gdGhpc09iai5HZXRQZXJjZW50UmVzdWx0KG5vd0xJVGFnLmRhdGFzZXQucGVyY2VudCk7XHJcbiAgICAgICAgICAgICAgICAvL3RoaXNPYmouUmVmcmVzaFByb2RJdGVtUGVyY2VudCgpO1xyXG4gICAgICAgICAgICAgICAgLy90aGlzT2JqLlNob3dUb3RhbEluZm8oKTsgIC8vIOiuiuaIkOWPluW+l+Wtl+S4suizh+ioiueahOaWueazlVxyXG4gICAgICAgICAgICAgICAgLy90aGlzT2JqLlNldEJpbmRpbmdWYWx1ZSgpOyAgLy8g6K6K5oiQ5Zue5YKzaW5wdXQgdGFn6ZuG5ZCIIOeEtuW+jOWGjeS4iuWxpOiHquihjOaxuuWumuWKoOWcqOWTquWAi1RhZ1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIEFjdGlvbiAgICBcclxuICAgICAgICAgICAgdGhpcy5BbGxQcm9kSXRlbUxzLnB1c2gobGlUYWcpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgR2V0UGVyY2VudFJlc3VsdChwZXJjZW50U3RyOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiBgXFx1MDBBMFxcdTAwQTAke3BlcmNlbnRTdHJ9JVxcdTAwQTBcXHUwMEEwYFxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBSZW1vdmUocHJvZEl0ZW1WYWw6IHN0cmluZykge1xyXG4gICAgICAgIGxldCB3UmVtb3ZlSXRlbSA9IHRoaXMuQWxsUHJvZEl0ZW1Mcy5maW5kKGl0ZW0gPT4gaXRlbS5kYXRhc2V0LnZhbHVlID09PSBwcm9kSXRlbVZhbCk7XHJcbiAgICAgICAgdGhpcy5BbGxQcm9kSXRlbUxzLnNwbGljZSh0aGlzLkFsbFByb2RJdGVtTHMuaW5kZXhPZih3UmVtb3ZlSXRlbSksIDEpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwdWJsaWMgUmVmcmVzaFByb2RJdGVtUGVyY2VudCgpIHtcclxuICAgICAgICB0aGlzLkFsbFByb2RJdGVtTHMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICBsZXQgc3BhblRhZyA9IGl0ZW0ucXVlcnlTZWxlY3RvcihcInNwYW5cIik7XHJcbiAgICAgICAgICAgIHNwYW5UYWcuaW5uZXJIVE1MID0gYFxcdTAwQTBcXHUwMEEwJHtpdGVtLmRhdGFzZXQucGVyY2VudH0lXFx1MDBBMFxcdTAwQTBgXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIEdldFRvdGFsSW5mb01zZygpOiBzdHJpbmcge1xyXG5cclxuICAgICAgICBsZXQgYWxsUGVyY2VudCA9IDA7XHJcbiAgICAgICAgbGV0IG1heEl0ZW06IEhUTUxMSUVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5BbGxQcm9kSXRlbUxzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgYWxsUGVyY2VudCA9ICsgaXRlbS5kYXRhc2V0LnBlcmNlbnQgKyBhbGxQZXJjZW50O1xyXG4gICAgICAgICAgICBpZiAoIW1heEl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIG1heEl0ZW0gPSBpdGVtO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbWF4SXRlbSA9ICttYXhJdGVtLmRhdGFzZXQucGVyY2VudCA+ICtpdGVtLmRhdGFzZXQucGVyY2VudCA/IG1heEl0ZW0gOiBpdGVtO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgY29uc3QgaXRlbVNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICBpdGVtU3Bhbi5pbm5lckhUTUwgPSBg77yM5bey6YG4JHt0aGlzLkFsbFByb2RJdGVtTHMubGVuZ3RofemghWA7XHJcbiAgICAgICAgY29uc3QgcGVyY2VudFNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICBwZXJjZW50U3Bhbi5pbm5lckhUTUwgPSBg77yM5q+U5L6L5Yqg57i9OiR7YWxsUGVyY2VudH0lYFxyXG4gICAgICAgIGlmIChhbGxQZXJjZW50ID4gMTAwKVxyXG4gICAgICAgICAgICBwZXJjZW50U3Bhbi5zdHlsZS5jb2xvciA9IFwicmVkXCI7XHJcbiAgICAgICAgY29uc3QgcmVjb2duaXRpb25TcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcblxyXG4gICAgICAgIHJlY29nbml0aW9uU3Bhbi5pbm5lckhUTUwgPSBg6KqN5YiX6aCF55uuIDogJHttYXhJdGVtPy5kYXRhc2V0LnRleHQgPz8gXCLnhKFcIn1gXHJcblxyXG5cclxuXHJcbiAgICAgICAgcmV0dXJuIGAke3JlY29nbml0aW9uU3Bhbi5pbm5lckhUTUx9JHtpdGVtU3Bhbi5pbm5lckhUTUx9JHtwZXJjZW50U3Bhbi5pbm5lckhUTUx9YFxyXG5cclxuXHJcbiAgICAgICAgLy9pZiAodGhpcy5BbGxQcm9kSXRlbUxzLmxlbmd0aCA+IDApXHJcbiAgICAgICAgLy8gICAgJCgnI0lzUGFzc1B1cmNoYXNlJykudmFsKFwidHJ1ZVwiKTtcclxuICAgICAgICAvL2Vsc2VcclxuICAgICAgICAvLyAgICAkKCcjSXNQYXNzUHVyY2hhc2UnKS52YWwoXCJmYWxzZVwiKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4iXX0=