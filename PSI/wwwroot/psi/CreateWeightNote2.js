var CreateWeightNotePage_Main = /** @class */ (function () {
    function CreateWeightNotePage_Main(baseUrl) {
        if (baseUrl === void 0) { baseUrl = ""; }
        this.BaseUrl = baseUrl;
        this.ProdList = new CreateWeightNotePage_ProdList("evenProductLs", "oddProductLs");
    }
    CreateWeightNotePage_Main.prototype.IniPageEvent = function () {
        // Page Field
        var fullWeight = $('#VE_PurchaseWeightNote_FullWeightTime').get(0);
        var defectiveWeight = $('#VE_PurchaseWeightNote_DefectiveWeight').get(0);
        var unitPrice = $('#VE_PurchaseWeightNote_UnitPrice').get(0);
        var traficUnitPrice = $('#VE_PurchaseWeightNote_TraficUnitPrice').get(0);
        var weightFee = $('#VE_PurchaseWeightNote_ThirdWeightFee').get(0);
        var ishasTaxList = $(".ishas_tax").get();
        // Logic        
        //fullWeight.addEventListener('keyup', this.CaculateAllFee);
        //defectiveWeight.addEventListener('keyup', this.CaculateAllFee);
        //unitPrice.addEventListener('keyup', this.CaculateAllFee);
        //traficUnitPrice.addEventListener('keyup', this.CaculateAllFee);
        //weightFee.addEventListener('keyup', this.CaculateAllFee);
        //ishasTaxList.forEach((item) => item.addEventListener('change', this.CaculateAllFee));
    };
    ;
    return CreateWeightNotePage_Main;
}());
;
var CreateWeightNotePage_Main2 = /** @class */ (function () {
    function CreateWeightNotePage_Main2(baseUrl) {
        if (baseUrl === void 0) { baseUrl = ""; }
        this._prodItemList = new PurchaseProdItemList();
        this.MinusPercentClassName = "minus-percent";
        this.PlusPercentClassName = "plus-percent";
        // Page  Dom
        this.EvenShow_JqUlDom = $('#evenProductLs');
        this.OddLShow_JqUlDom = $('#oddProductLs');
        this.UsProdItem_JqSelectDom = $('#user-select-proditem');
        this.TotalProdItemInfo_JqSelectDom = $('#total');
        this.BaseUrl = baseUrl;
    }
    /* Action */
    CreateWeightNotePage_Main2.prototype.USProdItem_Change = function () {
        var _this = this;
        var usProdItemDoms = this.UsProdItem_JqSelectDom.find(':selected').toArray();
        // User所選
        usProdItemDoms.forEach(function (item) {
            _this._prodItemList.AppendToProdItemList(item.value, item.text);
        });
        // 要刪除的
        this._prodItemList.Data.filter(function (showItem) {
            return !(usProdItemDoms.map(function (usItem) { return usItem.value; }).includes(showItem.prodId));
        }).forEach(function (showItem) { return _this._prodItemList.RemoveOfProdItemList(showItem.prodId); });
        // pageMain.ProdList.RefreshProdItemPercent();
        this.ShowUSProdItems();
    };
    CreateWeightNotePage_Main2.prototype.PlusProdItemPercent_Click = function (iTagDom) {
        var nowITag = iTagDom;
        var nowLiTag = nowITag.parentElement;
        var nowProdItem = this._prodItemList.Data.find(function (item) { return item.prodId === nowLiTag.dataset.value; });
        if (nowProdItem) {
            nowProdItem.percent = nowProdItem.percent + 10 > 100 ? 100 : nowProdItem.percent + 10;
        }
        this.ShowUSProdItems();
    };
    CreateWeightNotePage_Main2.prototype.MinusProdItemPercent_Click = function (iTagDom) {
        var nowITag = iTagDom;
        var nowLiTag = nowITag.parentElement;
        var nowProdItem = this._prodItemList.Data.find(function (item) { return item.prodId === nowLiTag.dataset.value; });
        if (nowProdItem) {
            nowProdItem.percent = nowProdItem.percent - 10 < 0 ? 0 : nowProdItem.percent - 10;
        }
        this.ShowUSProdItems();
    };
    /* Page Function */
    CreateWeightNotePage_Main2.prototype.ShowUSProdItems = function () {
        var _this = this;
        var evenShowUlDom = this.EvenShow_JqUlDom.get(0);
        var oddShowUlDom = this.OddLShow_JqUlDom.get(0);
        evenShowUlDom.innerHTML = "";
        oddShowUlDom.innerHTML = "";
        this._prodItemList.Data.forEach(function (item, index) {
            var iMinusTag = document.createElement("i");
            iMinusTag.classList.add("fas");
            iMinusTag.classList.add("fa-minus-circle");
            iMinusTag.classList.add(_this.MinusPercentClassName);
            iMinusTag.style.cursor = "pointer";
            iMinusTag.style.color = "blue";
            var iPlusTag = document.createElement("i");
            iPlusTag.classList.add("fas");
            iPlusTag.classList.add("fa-plus-circle");
            iPlusTag.classList.add(_this.PlusPercentClassName);
            iPlusTag.style.cursor = "pointer";
            iPlusTag.style.color = "red";
            var spanTag = document.createElement("span");
            var liTag = document.createElement("li");
            liTag.dataset.text = item.prodText;
            liTag.textContent = item.prodText + " \u00A0\u00A0";
            liTag.dataset.value = item.prodId;
            // liTag.dataset.percent = this._prodItemList.length === 0 ? "90" : "10";
            spanTag.innerHTML = "\u00A0\u00A0" + item.percent + "%\u00A0\u00A0";
            liTag.appendChild(iMinusTag);
            liTag.appendChild(spanTag);
            liTag.appendChild(iPlusTag);
            index % 2 === 0 ? evenShowUlDom.appendChild(liTag) :
                oddShowUlDom.appendChild(liTag);
        });
        this.ShowProdItemSummary();
    };
    CreateWeightNotePage_Main2.prototype.ShowProdItemSummary = function () {
        var _a;
        var allPercent = 0;
        var maxItem;
        this._prodItemList.Data.forEach(function (item) {
            allPercent = +item.percent + allPercent;
            if (!maxItem) {
                maxItem = item;
            }
            else {
                maxItem = +maxItem.percent > +item.percent ? maxItem : item;
            }
        });
        var itemSpan = document.createElement("span");
        itemSpan.innerHTML = "\uFF0C\u5DF2\u9078" + this._prodItemList.Data.length + "\u9805";
        var percentSpan = document.createElement("span");
        percentSpan.innerHTML = "\uFF0C\u6BD4\u4F8B\u52A0\u7E3D:" + allPercent + "%";
        if (allPercent > 100)
            percentSpan.style.color = "red";
        var recognitionSpan = document.createElement("span");
        recognitionSpan.innerHTML = "\u8A8D\u5217\u9805\u76EE : " + ((_a = maxItem === null || maxItem === void 0 ? void 0 : maxItem.prodText) !== null && _a !== void 0 ? _a : "無");
        //let summaryInfo = `${recognitionSpan.innerHTML}${itemSpan.innerHTML}${percentSpan.innerHTML}`;
        this.TotalProdItemInfo_JqSelectDom.get(0).innerHTML = "";
        this.TotalProdItemInfo_JqSelectDom.get(0).appendChild(recognitionSpan);
        this.TotalProdItemInfo_JqSelectDom.get(0).appendChild(itemSpan);
        this.TotalProdItemInfo_JqSelectDom.get(0).appendChild(percentSpan);
    };
    ;
    return CreateWeightNotePage_Main2;
}());
var CreateWeightNotePage_ProdList = /** @class */ (function () {
    function CreateWeightNotePage_ProdList(evenListId, oddListId) {
        this.CalPercentClassName = "testHaha";
        this.EvenListJQueryObj = $("#" + evenListId);
        this.EvenListHtmlObj = this.EvenListJQueryObj.get(0);
        this.OddListJQueryObj = $("#" + oddListId);
        this.OddListHtmlObj = this.OddListJQueryObj.get(0);
        this.AllProdItemLs = this.EvenListJQueryObj.find('li').toArray().concat(this.OddListJQueryObj.find('li').toArray());
    }
    CreateWeightNotePage_ProdList.prototype.Show = function () {
        var _this = this;
        this.EvenListHtmlObj.innerHTML = "";
        this.OddListHtmlObj.innerHTML = "";
        this.AllProdItemLs.forEach(function (item, index) {
            index % 2 === 0 ? _this.EvenListHtmlObj.appendChild(item) :
                _this.OddListHtmlObj.appendChild(item);
        });
    };
    CreateWeightNotePage_ProdList.prototype.Append = function (prodItemVal, prodItemText) {
        var thisObj = this;
        //alert(this.EvenListHtmlObj.id);
        //alert(this.OddListHtmlObj.id);
        //let evenLiTags = this.EvenListJQueryObj.find('li').toArray();
        //let oddLiTags = this.OddListJQueryObj.find('li').toArray();
        ////// $("#oddProductLs li").toArray()
        //const allShowLiTags = evenLiTags.concat(oddLiTags);
        //if (allShowLiTags)
        //    alert(allShowLiTags.map(item => { return item.dataset.value }))
        var isItemExist = this.AllProdItemLs.filter(function (item) { return item.dataset.value === prodItemVal; }).length > 0;
        if (!isItemExist) {
            var iMinusTag = document.createElement("i");
            iMinusTag.classList.add("fas");
            iMinusTag.classList.add("fa-minus-circle");
            iMinusTag.classList.add(this.CalPercentClassName);
            iMinusTag.style.cursor = "pointer";
            iMinusTag.style.color = "blue";
            var iPlusTag = document.createElement("i");
            iPlusTag.classList.add("fas");
            iPlusTag.classList.add("fa-plus-circle");
            iPlusTag.classList.add(this.CalPercentClassName);
            iPlusTag.style.cursor = "pointer";
            iPlusTag.style.color = "red";
            var spanTag = document.createElement("span");
            var liTag = document.createElement("li");
            liTag.dataset.text = prodItemText;
            liTag.textContent = prodItemText + " \u00A0\u00A0";
            liTag.dataset.value = prodItemVal;
            liTag.dataset.percent = this.AllProdItemLs.length === 0 ? "90" : "10";
            spanTag.innerHTML = thisObj.GetPercentResult(liTag.dataset.percent); // new
            liTag.appendChild(iMinusTag);
            liTag.appendChild(spanTag);
            liTag.appendChild(iPlusTag);
            //Event  下面的事件要拉到主頁去做  2個事件
            iMinusTag.addEventListener('click', function () {
                var nowLITag = this.parentElement;
                var newPercent = +nowLITag.dataset.percent - 10;
                nowLITag.dataset.percent = newPercent < 0 ? "0" : newPercent.toString();
                var spanTag = nowLITag.querySelector("span");
                spanTag.innerHTML = thisObj.GetPercentResult(nowLITag.dataset.percent);
                //thisObj.RefreshProdItemPercent();
                //thisObj.ShowTotalInfo();
                //thisObj.SetBindingValue();        在完成這個         
            });
            iPlusTag.addEventListener('click', function () {
                var nowLITag = this.parentElement;
                var newPercent = +nowLITag.dataset.percent + 10;
                nowLITag.dataset.percent = newPercent > 100 ? "100" : newPercent.toString();
                var spanTag = nowLITag.querySelector("span");
                spanTag.innerHTML = thisObj.GetPercentResult(nowLITag.dataset.percent);
                //thisObj.RefreshProdItemPercent();
                //thisObj.ShowTotalInfo();  // 變成取得字串資訊的方法
                //thisObj.SetBindingValue();  // 變成回傳input tag集合 然後再上層自行決定加在哪個Tag
            });
            // Action    
            this.AllProdItemLs.push(liTag);
        }
    };
    CreateWeightNotePage_ProdList.prototype.GetPercentResult = function (percentStr) {
        return "\u00A0\u00A0" + percentStr + "%\u00A0\u00A0";
    };
    CreateWeightNotePage_ProdList.prototype.Remove = function (prodItemVal) {
        var wRemoveItem = this.AllProdItemLs.find(function (item) { return item.dataset.value === prodItemVal; });
        this.AllProdItemLs.splice(this.AllProdItemLs.indexOf(wRemoveItem), 1);
    };
    CreateWeightNotePage_ProdList.prototype.RefreshProdItemPercent = function () {
        this.AllProdItemLs.forEach(function (item) {
            var spanTag = item.querySelector("span");
            spanTag.innerHTML = "\u00A0\u00A0" + item.dataset.percent + "%\u00A0\u00A0";
        });
    };
    CreateWeightNotePage_ProdList.prototype.GetTotalInfoMsg = function () {
        var _a;
        var allPercent = 0;
        var maxItem;
        this.AllProdItemLs.forEach(function (item) {
            allPercent = +item.dataset.percent + allPercent;
            if (!maxItem) {
                maxItem = item;
            }
            else {
                maxItem = +maxItem.dataset.percent > +item.dataset.percent ? maxItem : item;
            }
        });
        var itemSpan = document.createElement("span");
        itemSpan.innerHTML = "\uFF0C\u5DF2\u9078" + this.AllProdItemLs.length + "\u9805";
        var percentSpan = document.createElement("span");
        percentSpan.innerHTML = "\uFF0C\u6BD4\u4F8B\u52A0\u7E3D:" + allPercent + "%";
        if (allPercent > 100)
            percentSpan.style.color = "red";
        var recognitionSpan = document.createElement("span");
        recognitionSpan.innerHTML = "\u8A8D\u5217\u9805\u76EE : " + ((_a = maxItem === null || maxItem === void 0 ? void 0 : maxItem.dataset.text) !== null && _a !== void 0 ? _a : "無");
        return "" + recognitionSpan.innerHTML + itemSpan.innerHTML + percentSpan.innerHTML;
        //if (this.AllProdItemLs.length > 0)
        //    $('#IsPassPurchase').val("true");
        //else
        //    $('#IsPassPurchase').val("false");
    };
    return CreateWeightNotePage_ProdList;
}());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ3JlYXRlV2VpZ2h0Tm90ZTIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zY3JpcHRzL0NyZWF0ZVdlaWdodE5vdGUyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0lBUUksbUNBQVksT0FBb0I7UUFBcEIsd0JBQUEsRUFBQSxZQUFvQjtRQUM1QixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksNkJBQTZCLENBQUMsZUFBZSxFQUFFLGNBQWMsQ0FBQyxDQUFDO0lBQ3ZGLENBQUM7SUFHTSxnREFBWSxHQUFuQjtRQUNJLGFBQWE7UUFDYixJQUFJLFVBQVUsR0FBRyxDQUFDLENBQUMsdUNBQXVDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkUsSUFBSSxlQUFlLEdBQUcsQ0FBQyxDQUFDLHdDQUF3QyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3pFLElBQUksU0FBUyxHQUFHLENBQUMsQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM3RCxJQUFJLGVBQWUsR0FBRyxDQUFDLENBQUMsd0NBQXdDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekUsSUFBSSxTQUFTLEdBQUcsQ0FBQyxDQUFDLHVDQUF1QyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xFLElBQUksWUFBWSxHQUFHLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUV6QyxnQkFBZ0I7UUFDaEIsNERBQTREO1FBQzVELGlFQUFpRTtRQUNqRSwyREFBMkQ7UUFDM0QsaUVBQWlFO1FBQ2pFLDJEQUEyRDtRQUMzRCx1RkFBdUY7SUFDM0YsQ0FBQztJQUFBLENBQUM7SUFHTixnQ0FBQztBQUFELENBQUMsQUFqQ0QsSUFpQ0M7QUFBQSxDQUFDO0FB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QUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO2FBQy9FO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFJSCxJQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2hELFFBQVEsQ0FBQyxTQUFTLEdBQUcsdUJBQU0sSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLFdBQUcsQ0FBQztRQUN4RCxJQUFNLFdBQVcsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ25ELFdBQVcsQ0FBQyxTQUFTLEdBQUcsb0NBQVMsVUFBVSxNQUFHLENBQUE7UUFDOUMsSUFBSSxVQUFVLEdBQUcsR0FBRztZQUNoQixXQUFXLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDcEMsSUFBTSxlQUFlLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUV2RCxlQUFlLENBQUMsU0FBUyxHQUFHLGlDQUFVLE1BQUEsT0FBTyxhQUFQLE9BQU8sdUJBQVAsT0FBTyxDQUFFLE9BQU8sQ0FBQyxJQUFJLG1DQUFJLEdBQUcsQ0FBRSxDQUFBO1FBSXBFLE9BQU8sS0FBRyxlQUFlLENBQUMsU0FBUyxHQUFHLFFBQVEsQ0FBQyxTQUFTLEdBQUcsV0FBVyxDQUFDLFNBQVcsQ0FBQTtRQUdsRixvQ0FBb0M7UUFDcEMsdUNBQXVDO1FBQ3ZDLE1BQU07UUFDTix3Q0FBd0M7SUFDNUMsQ0FBQztJQUNMLG9DQUFDO0FBQUQsQ0FBQyxBQTNKRCxJQTJKQyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIENyZWF0ZVdlaWdodE5vdGVQYWdlX01haW4ge1xyXG4gICAgLy8gUG9ycGVyaXRlc1xyXG4gICAgcHVibGljIFByb2RMaXN0OiBDcmVhdGVXZWlnaHROb3RlUGFnZV9Qcm9kTGlzdDtcclxuXHJcblxyXG5cclxuXHJcbiAgICBCYXNlVXJsOiBzdHJpbmc7XHJcbiAgICBjb25zdHJ1Y3RvcihiYXNlVXJsOiBzdHJpbmcgPSBcIlwiKSB7XHJcbiAgICAgICAgdGhpcy5CYXNlVXJsID0gYmFzZVVybDtcclxuICAgICAgICB0aGlzLlByb2RMaXN0ID0gbmV3IENyZWF0ZVdlaWdodE5vdGVQYWdlX1Byb2RMaXN0KFwiZXZlblByb2R1Y3RMc1wiLCBcIm9kZFByb2R1Y3RMc1wiKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHVibGljIEluaVBhZ2VFdmVudCgpIHtcclxuICAgICAgICAvLyBQYWdlIEZpZWxkXHJcbiAgICAgICAgbGV0IGZ1bGxXZWlnaHQgPSAkKCcjVkVfUHVyY2hhc2VXZWlnaHROb3RlX0Z1bGxXZWlnaHRUaW1lJykuZ2V0KDApO1xyXG4gICAgICAgIGxldCBkZWZlY3RpdmVXZWlnaHQgPSAkKCcjVkVfUHVyY2hhc2VXZWlnaHROb3RlX0RlZmVjdGl2ZVdlaWdodCcpLmdldCgwKTtcclxuICAgICAgICBsZXQgdW5pdFByaWNlID0gJCgnI1ZFX1B1cmNoYXNlV2VpZ2h0Tm90ZV9Vbml0UHJpY2UnKS5nZXQoMCk7XHJcbiAgICAgICAgbGV0IHRyYWZpY1VuaXRQcmljZSA9ICQoJyNWRV9QdXJjaGFzZVdlaWdodE5vdGVfVHJhZmljVW5pdFByaWNlJykuZ2V0KDApO1xyXG4gICAgICAgIGxldCB3ZWlnaHRGZWUgPSAkKCcjVkVfUHVyY2hhc2VXZWlnaHROb3RlX1RoaXJkV2VpZ2h0RmVlJykuZ2V0KDApO1xyXG4gICAgICAgIGxldCBpc2hhc1RheExpc3QgPSAkKFwiLmlzaGFzX3RheFwiKS5nZXQoKTtcclxuXHJcbiAgICAgICAgLy8gTG9naWMgICAgICAgIFxyXG4gICAgICAgIC8vZnVsbFdlaWdodC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRoaXMuQ2FjdWxhdGVBbGxGZWUpO1xyXG4gICAgICAgIC8vZGVmZWN0aXZlV2VpZ2h0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5DYWN1bGF0ZUFsbEZlZSk7XHJcbiAgICAgICAgLy91bml0UHJpY2UuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLkNhY3VsYXRlQWxsRmVlKTtcclxuICAgICAgICAvL3RyYWZpY1VuaXRQcmljZS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRoaXMuQ2FjdWxhdGVBbGxGZWUpO1xyXG4gICAgICAgIC8vd2VpZ2h0RmVlLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5DYWN1bGF0ZUFsbEZlZSk7XHJcbiAgICAgICAgLy9pc2hhc1RheExpc3QuZm9yRWFjaCgoaXRlbSkgPT4gaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB0aGlzLkNhY3VsYXRlQWxsRmVlKSk7XHJcbiAgICB9O1xyXG5cclxuXHJcbn07XHJcblxyXG5jbGFzcyBDcmVhdGVXZWlnaHROb3RlUGFnZV9NYWluMiB7XHJcbiAgICAvLyBQb3JwZXJpdGVzXHJcbiAgICByZWFkb25seSBCYXNlVXJsOiBzdHJpbmc7XHJcbiAgICBwdWJsaWMgX3Byb2RJdGVtTGlzdDogUHVyY2hhc2VQcm9kSXRlbUxpc3QgPSBuZXcgUHVyY2hhc2VQcm9kSXRlbUxpc3QoKTtcclxuICAgIHJlYWRvbmx5IE1pbnVzUGVyY2VudENsYXNzTmFtZTogc3RyaW5nID0gXCJtaW51cy1wZXJjZW50XCJcclxuICAgIHJlYWRvbmx5IFBsdXNQZXJjZW50Q2xhc3NOYW1lOiBzdHJpbmcgPSBcInBsdXMtcGVyY2VudFwiXHJcblxyXG4gICAgLy8gUGFnZSAgRG9tXHJcbiAgICBwdWJsaWMgRXZlblNob3dfSnFVbERvbTogSlF1ZXJ5PEhUTUxVTGlzdEVsZW1lbnQ+ID0gJCgnI2V2ZW5Qcm9kdWN0THMnKTtcclxuICAgIHB1YmxpYyBPZGRMU2hvd19KcVVsRG9tOiBKUXVlcnk8SFRNTFVMaXN0RWxlbWVudD4gPSAkKCcjb2RkUHJvZHVjdExzJyk7XHJcbiAgICBwdWJsaWMgVXNQcm9kSXRlbV9KcVNlbGVjdERvbTogSlF1ZXJ5PEhUTUxTZWxlY3RFbGVtZW50PiA9ICQoJyN1c2VyLXNlbGVjdC1wcm9kaXRlbScpO1xyXG4gICAgcHVibGljIFRvdGFsUHJvZEl0ZW1JbmZvX0pxU2VsZWN0RG9tOiBKUXVlcnk8SFRNTEhlYWRpbmdFbGVtZW50PiA9ICQoJyN0b3RhbCcpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcbiAgICBjb25zdHJ1Y3RvcihiYXNlVXJsOiBzdHJpbmcgPSBcIlwiKSB7XHJcbiAgICAgICAgdGhpcy5CYXNlVXJsID0gYmFzZVVybDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyogQWN0aW9uICovXHJcbiAgICBwdWJsaWMgVVNQcm9kSXRlbV9DaGFuZ2UoKSB7XHJcbiAgICAgICAgbGV0IHVzUHJvZEl0ZW1Eb21zID0gdGhpcy5Vc1Byb2RJdGVtX0pxU2VsZWN0RG9tLmZpbmQoJzpzZWxlY3RlZCcpLnRvQXJyYXkoKSBhcyBIVE1MT3B0aW9uRWxlbWVudFtdO1xyXG5cclxuICAgICAgICAvLyBVc2Vy5omA6YG4XHJcbiAgICAgICAgdXNQcm9kSXRlbURvbXMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgdGhpcy5fcHJvZEl0ZW1MaXN0LkFwcGVuZFRvUHJvZEl0ZW1MaXN0KGl0ZW0udmFsdWUsIGl0ZW0udGV4dCk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgLy8g6KaB5Yiq6Zmk55qEXHJcbiAgICAgICAgdGhpcy5fcHJvZEl0ZW1MaXN0LkRhdGEuZmlsdGVyKHNob3dJdGVtID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuICEodXNQcm9kSXRlbURvbXMubWFwKHVzSXRlbSA9PiB1c0l0ZW0udmFsdWUpLmluY2x1ZGVzKHNob3dJdGVtLnByb2RJZCkpO1xyXG4gICAgICAgIH0pLmZvckVhY2goc2hvd0l0ZW0gPT4gdGhpcy5fcHJvZEl0ZW1MaXN0LlJlbW92ZU9mUHJvZEl0ZW1MaXN0KHNob3dJdGVtLnByb2RJZCkpO1xyXG5cclxuICAgICAgICAvLyBwYWdlTWFpbi5Qcm9kTGlzdC5SZWZyZXNoUHJvZEl0ZW1QZXJjZW50KCk7XHJcbiAgICAgICAgdGhpcy5TaG93VVNQcm9kSXRlbXMoKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIFBsdXNQcm9kSXRlbVBlcmNlbnRfQ2xpY2soaVRhZ0RvbTogSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICBsZXQgbm93SVRhZyA9IGlUYWdEb207XHJcbiAgICAgICAgbGV0IG5vd0xpVGFnID0gbm93SVRhZy5wYXJlbnRFbGVtZW50IGFzIEhUTUxMSUVsZW1lbnQ7XHJcblxyXG4gICAgICAgIGxldCBub3dQcm9kSXRlbSA9IHRoaXMuX3Byb2RJdGVtTGlzdC5EYXRhLmZpbmQoaXRlbSA9PiBpdGVtLnByb2RJZCA9PT0gbm93TGlUYWcuZGF0YXNldC52YWx1ZSk7XHJcbiAgICAgICAgaWYgKG5vd1Byb2RJdGVtKSB7XHJcbiAgICAgICAgICAgIG5vd1Byb2RJdGVtLnBlcmNlbnQgPSBub3dQcm9kSXRlbS5wZXJjZW50ICsgMTAgPiAxMDAgPyAxMDAgOiBub3dQcm9kSXRlbS5wZXJjZW50ICsgMTA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuU2hvd1VTUHJvZEl0ZW1zKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIE1pbnVzUHJvZEl0ZW1QZXJjZW50X0NsaWNrKGlUYWdEb206IEhUTUxFbGVtZW50KSB7XHJcbiAgICAgICAgbGV0IG5vd0lUYWcgPSBpVGFnRG9tO1xyXG4gICAgICAgIGxldCBub3dMaVRhZyA9IG5vd0lUYWcucGFyZW50RWxlbWVudCBhcyBIVE1MTElFbGVtZW50O1xyXG5cclxuICAgICAgICBsZXQgbm93UHJvZEl0ZW0gPSB0aGlzLl9wcm9kSXRlbUxpc3QuRGF0YS5maW5kKGl0ZW0gPT4gaXRlbS5wcm9kSWQgPT09IG5vd0xpVGFnLmRhdGFzZXQudmFsdWUpO1xyXG4gICAgICAgIGlmIChub3dQcm9kSXRlbSkge1xyXG4gICAgICAgICAgICBub3dQcm9kSXRlbS5wZXJjZW50ID0gbm93UHJvZEl0ZW0ucGVyY2VudCAtIDEwIDwgMCA/IDAgOiBub3dQcm9kSXRlbS5wZXJjZW50IC0gMTA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuU2hvd1VTUHJvZEl0ZW1zKCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qIFBhZ2UgRnVuY3Rpb24gKi9cclxuXHJcbiAgICBwcml2YXRlIFNob3dVU1Byb2RJdGVtcygpIHtcclxuICAgICAgICBsZXQgZXZlblNob3dVbERvbSA9IHRoaXMuRXZlblNob3dfSnFVbERvbS5nZXQoMCk7XHJcbiAgICAgICAgbGV0IG9kZFNob3dVbERvbSA9IHRoaXMuT2RkTFNob3dfSnFVbERvbS5nZXQoMCk7XHJcbiAgICAgICAgZXZlblNob3dVbERvbS5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgICAgIG9kZFNob3dVbERvbS5pbm5lckhUTUwgPSBcIlwiO1xyXG5cclxuXHJcbiAgICAgICAgdGhpcy5fcHJvZEl0ZW1MaXN0LkRhdGEuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGlNaW51c1RhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpXCIpO1xyXG4gICAgICAgICAgICBpTWludXNUYWcuY2xhc3NMaXN0LmFkZChcImZhc1wiKTtcclxuICAgICAgICAgICAgaU1pbnVzVGFnLmNsYXNzTGlzdC5hZGQoXCJmYS1taW51cy1jaXJjbGVcIik7XHJcbiAgICAgICAgICAgIGlNaW51c1RhZy5jbGFzc0xpc3QuYWRkKHRoaXMuTWludXNQZXJjZW50Q2xhc3NOYW1lKTtcclxuICAgICAgICAgICAgaU1pbnVzVGFnLnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiO1xyXG4gICAgICAgICAgICBpTWludXNUYWcuc3R5bGUuY29sb3IgPSBcImJsdWVcIjtcclxuICAgICAgICAgICAgY29uc3QgaVBsdXNUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaVwiKTtcclxuICAgICAgICAgICAgaVBsdXNUYWcuY2xhc3NMaXN0LmFkZChcImZhc1wiKTtcclxuICAgICAgICAgICAgaVBsdXNUYWcuY2xhc3NMaXN0LmFkZChcImZhLXBsdXMtY2lyY2xlXCIpO1xyXG4gICAgICAgICAgICBpUGx1c1RhZy5jbGFzc0xpc3QuYWRkKHRoaXMuUGx1c1BlcmNlbnRDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICBpUGx1c1RhZy5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcclxuICAgICAgICAgICAgaVBsdXNUYWcuc3R5bGUuY29sb3IgPSBcInJlZFwiO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3BhblRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpIGFzIEhUTUxTcGFuRWxlbWVudDtcclxuICAgICAgICAgICAgY29uc3QgbGlUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIikgYXMgSFRNTExJRWxlbWVudDtcclxuICAgICAgICAgICAgbGlUYWcuZGF0YXNldC50ZXh0ID0gaXRlbS5wcm9kVGV4dDtcclxuICAgICAgICAgICAgbGlUYWcudGV4dENvbnRlbnQgPSBgJHtpdGVtLnByb2RUZXh0fSBcXHUwMEEwXFx1MDBBMGA7XHJcbiAgICAgICAgICAgIGxpVGFnLmRhdGFzZXQudmFsdWUgPSBpdGVtLnByb2RJZDtcclxuICAgICAgICAgICAgLy8gbGlUYWcuZGF0YXNldC5wZXJjZW50ID0gdGhpcy5fcHJvZEl0ZW1MaXN0Lmxlbmd0aCA9PT0gMCA/IFwiOTBcIiA6IFwiMTBcIjtcclxuICAgICAgICAgICAgc3BhblRhZy5pbm5lckhUTUwgPSBgXFx1MDBBMFxcdTAwQTAke2l0ZW0ucGVyY2VudH0lXFx1MDBBMFxcdTAwQTBgO1xyXG4gICAgICAgICAgICBsaVRhZy5hcHBlbmRDaGlsZChpTWludXNUYWcpO1xyXG4gICAgICAgICAgICBsaVRhZy5hcHBlbmRDaGlsZChzcGFuVGFnKTtcclxuICAgICAgICAgICAgbGlUYWcuYXBwZW5kQ2hpbGQoaVBsdXNUYWcpO1xyXG5cclxuICAgICAgICAgICAgaW5kZXggJSAyID09PSAwID8gZXZlblNob3dVbERvbS5hcHBlbmRDaGlsZChsaVRhZykgOlxyXG4gICAgICAgICAgICAgICAgb2RkU2hvd1VsRG9tLmFwcGVuZENoaWxkKGxpVGFnKVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgdGhpcy5TaG93UHJvZEl0ZW1TdW1tYXJ5KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBTaG93UHJvZEl0ZW1TdW1tYXJ5KCkge1xyXG5cclxuICAgICAgICBsZXQgYWxsUGVyY2VudCA9IDA7XHJcbiAgICAgICAgbGV0IG1heEl0ZW06IFB1cmNoYXNlUHJvZEl0ZW07XHJcbiAgICAgICAgdGhpcy5fcHJvZEl0ZW1MaXN0LkRhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICBhbGxQZXJjZW50ID0gKyBpdGVtLnBlcmNlbnQgKyBhbGxQZXJjZW50O1xyXG4gICAgICAgICAgICBpZiAoIW1heEl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIG1heEl0ZW0gPSBpdGVtO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbWF4SXRlbSA9ICttYXhJdGVtLnBlcmNlbnQgPiAraXRlbS5wZXJjZW50ID8gbWF4SXRlbSA6IGl0ZW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIGNvbnN0IGl0ZW1TcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgaXRlbVNwYW4uaW5uZXJIVE1MID0gYO+8jOW3sumBuCR7dGhpcy5fcHJvZEl0ZW1MaXN0LkRhdGEubGVuZ3RofemghWA7XHJcbiAgICAgICAgY29uc3QgcGVyY2VudFNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICBwZXJjZW50U3Bhbi5pbm5lckhUTUwgPSBg77yM5q+U5L6L5Yqg57i9OiR7YWxsUGVyY2VudH0lYFxyXG4gICAgICAgIGlmIChhbGxQZXJjZW50ID4gMTAwKVxyXG4gICAgICAgICAgICBwZXJjZW50U3Bhbi5zdHlsZS5jb2xvciA9IFwicmVkXCI7XHJcbiAgICAgICAgY29uc3QgcmVjb2duaXRpb25TcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgcmVjb2duaXRpb25TcGFuLmlubmVySFRNTCA9IGDoqo3liJfpoIXnm64gOiAke21heEl0ZW0/LnByb2RUZXh0ID8/IFwi54ShXCJ9YFxyXG5cclxuXHJcblxyXG4gICAgICAgIC8vbGV0IHN1bW1hcnlJbmZvID0gYCR7cmVjb2duaXRpb25TcGFuLmlubmVySFRNTH0ke2l0ZW1TcGFuLmlubmVySFRNTH0ke3BlcmNlbnRTcGFuLmlubmVySFRNTH1gO1xyXG5cclxuICAgICAgICB0aGlzLlRvdGFsUHJvZEl0ZW1JbmZvX0pxU2VsZWN0RG9tLmdldCgwKS5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgICAgIHRoaXMuVG90YWxQcm9kSXRlbUluZm9fSnFTZWxlY3REb20uZ2V0KDApLmFwcGVuZENoaWxkKHJlY29nbml0aW9uU3Bhbik7XHJcbiAgICAgICAgdGhpcy5Ub3RhbFByb2RJdGVtSW5mb19KcVNlbGVjdERvbS5nZXQoMCkuYXBwZW5kQ2hpbGQoaXRlbVNwYW4pO1xyXG4gICAgICAgIHRoaXMuVG90YWxQcm9kSXRlbUluZm9fSnFTZWxlY3REb20uZ2V0KDApLmFwcGVuZENoaWxkKHBlcmNlbnRTcGFuKTtcclxuXHJcblxyXG4gICAgfTtcclxufVxyXG5cclxuXHJcblxyXG5jbGFzcyBDcmVhdGVXZWlnaHROb3RlUGFnZV9Qcm9kTGlzdCB7XHJcbiAgICBwdWJsaWMgRXZlbkxpc3RIdG1sT2JqOiBIVE1MVUxpc3RFbGVtZW50O1xyXG4gICAgcHVibGljIEV2ZW5MaXN0SlF1ZXJ5T2JqOiBKUXVlcnk8SFRNTFVMaXN0RWxlbWVudD47XHJcbiAgICBwdWJsaWMgT2RkTGlzdEh0bWxPYmo6IEhUTUxVTGlzdEVsZW1lbnQ7XHJcbiAgICBwdWJsaWMgT2RkTGlzdEpRdWVyeU9iajogSlF1ZXJ5PEhUTUxVTGlzdEVsZW1lbnQ+O1xyXG4gICAgcHJpdmF0ZSBBbGxQcm9kSXRlbUxzOiBIVE1MTElFbGVtZW50W107XHJcbiAgICByZWFkb25seSBDYWxQZXJjZW50Q2xhc3NOYW1lOiBzdHJpbmcgPSBcInRlc3RIYWhhXCI7XHJcblxyXG5cclxuICAgIGNvbnN0cnVjdG9yKGV2ZW5MaXN0SWQ6IHN0cmluZywgb2RkTGlzdElkOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLkV2ZW5MaXN0SlF1ZXJ5T2JqID0gJChgIyR7ZXZlbkxpc3RJZH1gKVxyXG4gICAgICAgIHRoaXMuRXZlbkxpc3RIdG1sT2JqID0gdGhpcy5FdmVuTGlzdEpRdWVyeU9iai5nZXQoMCk7XHJcbiAgICAgICAgdGhpcy5PZGRMaXN0SlF1ZXJ5T2JqID0gJChgIyR7b2RkTGlzdElkfWApXHJcbiAgICAgICAgdGhpcy5PZGRMaXN0SHRtbE9iaiA9IHRoaXMuT2RkTGlzdEpRdWVyeU9iai5nZXQoMCk7XHJcbiAgICAgICAgdGhpcy5BbGxQcm9kSXRlbUxzID0gdGhpcy5FdmVuTGlzdEpRdWVyeU9iai5maW5kKCdsaScpLnRvQXJyYXkoKS5jb25jYXQoXHJcbiAgICAgICAgICAgIHRoaXMuT2RkTGlzdEpRdWVyeU9iai5maW5kKCdsaScpLnRvQXJyYXkoKSlcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgU2hvdygpIHtcclxuICAgICAgICB0aGlzLkV2ZW5MaXN0SHRtbE9iai5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgICAgIHRoaXMuT2RkTGlzdEh0bWxPYmouaW5uZXJIVE1MID0gXCJcIjtcclxuICAgICAgICB0aGlzLkFsbFByb2RJdGVtTHMuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgaW5kZXggJSAyID09PSAwID8gdGhpcy5FdmVuTGlzdEh0bWxPYmouYXBwZW5kQ2hpbGQoaXRlbSkgOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5PZGRMaXN0SHRtbE9iai5hcHBlbmRDaGlsZChpdGVtKVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyBBcHBlbmQocHJvZEl0ZW1WYWw6IHN0cmluZywgcHJvZEl0ZW1UZXh0OiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgdGhpc09iaiA9IHRoaXM7XHJcbiAgICAgICAgLy9hbGVydCh0aGlzLkV2ZW5MaXN0SHRtbE9iai5pZCk7XHJcbiAgICAgICAgLy9hbGVydCh0aGlzLk9kZExpc3RIdG1sT2JqLmlkKTtcclxuXHJcbiAgICAgICAgLy9sZXQgZXZlbkxpVGFncyA9IHRoaXMuRXZlbkxpc3RKUXVlcnlPYmouZmluZCgnbGknKS50b0FycmF5KCk7XHJcbiAgICAgICAgLy9sZXQgb2RkTGlUYWdzID0gdGhpcy5PZGRMaXN0SlF1ZXJ5T2JqLmZpbmQoJ2xpJykudG9BcnJheSgpO1xyXG5cclxuICAgICAgICAvLy8vLy8gJChcIiNvZGRQcm9kdWN0THMgbGlcIikudG9BcnJheSgpXHJcbiAgICAgICAgLy9jb25zdCBhbGxTaG93TGlUYWdzID0gZXZlbkxpVGFncy5jb25jYXQob2RkTGlUYWdzKTtcclxuXHJcbiAgICAgICAgLy9pZiAoYWxsU2hvd0xpVGFncylcclxuICAgICAgICAvLyAgICBhbGVydChhbGxTaG93TGlUYWdzLm1hcChpdGVtID0+IHsgcmV0dXJuIGl0ZW0uZGF0YXNldC52YWx1ZSB9KSlcclxuXHJcbiAgICAgICAgY29uc3QgaXNJdGVtRXhpc3QgPSB0aGlzLkFsbFByb2RJdGVtTHMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5kYXRhc2V0LnZhbHVlID09PSBwcm9kSXRlbVZhbCkubGVuZ3RoID4gMDtcclxuICAgICAgICBpZiAoIWlzSXRlbUV4aXN0KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlNaW51c1RhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpXCIpO1xyXG4gICAgICAgICAgICBpTWludXNUYWcuY2xhc3NMaXN0LmFkZChcImZhc1wiKTtcclxuICAgICAgICAgICAgaU1pbnVzVGFnLmNsYXNzTGlzdC5hZGQoXCJmYS1taW51cy1jaXJjbGVcIik7XHJcbiAgICAgICAgICAgIGlNaW51c1RhZy5jbGFzc0xpc3QuYWRkKHRoaXMuQ2FsUGVyY2VudENsYXNzTmFtZSk7XHJcbiAgICAgICAgICAgIGlNaW51c1RhZy5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcclxuICAgICAgICAgICAgaU1pbnVzVGFnLnN0eWxlLmNvbG9yID0gXCJibHVlXCI7XHJcbiAgICAgICAgICAgIGNvbnN0IGlQbHVzVGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlcIik7XHJcbiAgICAgICAgICAgIGlQbHVzVGFnLmNsYXNzTGlzdC5hZGQoXCJmYXNcIik7XHJcbiAgICAgICAgICAgIGlQbHVzVGFnLmNsYXNzTGlzdC5hZGQoXCJmYS1wbHVzLWNpcmNsZVwiKTtcclxuICAgICAgICAgICAgaVBsdXNUYWcuY2xhc3NMaXN0LmFkZCh0aGlzLkNhbFBlcmNlbnRDbGFzc05hbWUpO1xyXG4gICAgICAgICAgICBpUGx1c1RhZy5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcclxuICAgICAgICAgICAgaVBsdXNUYWcuc3R5bGUuY29sb3IgPSBcInJlZFwiO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3BhblRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpIGFzIEhUTUxTcGFuRWxlbWVudDtcclxuICAgICAgICAgICAgY29uc3QgbGlUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIikgYXMgSFRNTExJRWxlbWVudDtcclxuICAgICAgICAgICAgbGlUYWcuZGF0YXNldC50ZXh0ID0gcHJvZEl0ZW1UZXh0O1xyXG4gICAgICAgICAgICBsaVRhZy50ZXh0Q29udGVudCA9IGAke3Byb2RJdGVtVGV4dH0gXFx1MDBBMFxcdTAwQTBgO1xyXG4gICAgICAgICAgICBsaVRhZy5kYXRhc2V0LnZhbHVlID0gcHJvZEl0ZW1WYWw7XHJcbiAgICAgICAgICAgIGxpVGFnLmRhdGFzZXQucGVyY2VudCA9IHRoaXMuQWxsUHJvZEl0ZW1Mcy5sZW5ndGggPT09IDAgPyBcIjkwXCIgOiBcIjEwXCI7XHJcbiAgICAgICAgICAgIHNwYW5UYWcuaW5uZXJIVE1MID0gdGhpc09iai5HZXRQZXJjZW50UmVzdWx0KGxpVGFnLmRhdGFzZXQucGVyY2VudCkgIC8vIG5ld1xyXG4gICAgICAgICAgICBsaVRhZy5hcHBlbmRDaGlsZChpTWludXNUYWcpO1xyXG4gICAgICAgICAgICBsaVRhZy5hcHBlbmRDaGlsZChzcGFuVGFnKTtcclxuICAgICAgICAgICAgbGlUYWcuYXBwZW5kQ2hpbGQoaVBsdXNUYWcpO1xyXG5cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgLy9FdmVudCAg5LiL6Z2i55qE5LqL5Lu26KaB5ouJ5Yiw5Li76aCB5Y675YGaICAy5YCL5LqL5Lu2XHJcblxyXG4gICAgICAgICAgICBpTWludXNUYWcuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbm93TElUYWcgPSB0aGlzLnBhcmVudEVsZW1lbnQgYXMgSFRNTExJRWxlbWVudDtcclxuICAgICAgICAgICAgICAgIGxldCBuZXdQZXJjZW50OiBudW1iZXIgPSArbm93TElUYWcuZGF0YXNldC5wZXJjZW50IC0gMTA7XHJcbiAgICAgICAgICAgICAgICBub3dMSVRhZy5kYXRhc2V0LnBlcmNlbnQgPSBuZXdQZXJjZW50IDwgMCA/IFwiMFwiIDogbmV3UGVyY2VudC50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHNwYW5UYWcgPSBub3dMSVRhZy5xdWVyeVNlbGVjdG9yKFwic3BhblwiKTtcclxuICAgICAgICAgICAgICAgIHNwYW5UYWcuaW5uZXJIVE1MID0gdGhpc09iai5HZXRQZXJjZW50UmVzdWx0KG5vd0xJVGFnLmRhdGFzZXQucGVyY2VudCk7XHJcbiAgICAgICAgICAgICAgICAvL3RoaXNPYmouUmVmcmVzaFByb2RJdGVtUGVyY2VudCgpO1xyXG4gICAgICAgICAgICAgICAgLy90aGlzT2JqLlNob3dUb3RhbEluZm8oKTtcclxuICAgICAgICAgICAgICAgIC8vdGhpc09iai5TZXRCaW5kaW5nVmFsdWUoKTsgICAgICAgIOWcqOWujOaIkOmAmeWAiyAgICAgICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlQbHVzVGFnLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IG5vd0xJVGFnID0gdGhpcy5wYXJlbnRFbGVtZW50IGFzIEhUTUxMSUVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICBsZXQgbmV3UGVyY2VudDogbnVtYmVyID0gK25vd0xJVGFnLmRhdGFzZXQucGVyY2VudCArIDEwO1xyXG4gICAgICAgICAgICAgICAgbm93TElUYWcuZGF0YXNldC5wZXJjZW50ID0gbmV3UGVyY2VudCA+IDEwMCA/IFwiMTAwXCIgOiBuZXdQZXJjZW50LnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgc3BhblRhZyA9IG5vd0xJVGFnLnF1ZXJ5U2VsZWN0b3IoXCJzcGFuXCIpO1xyXG4gICAgICAgICAgICAgICAgc3BhblRhZy5pbm5lckhUTUwgPSB0aGlzT2JqLkdldFBlcmNlbnRSZXN1bHQobm93TElUYWcuZGF0YXNldC5wZXJjZW50KTtcclxuICAgICAgICAgICAgICAgIC8vdGhpc09iai5SZWZyZXNoUHJvZEl0ZW1QZXJjZW50KCk7XHJcbiAgICAgICAgICAgICAgICAvL3RoaXNPYmouU2hvd1RvdGFsSW5mbygpOyAgLy8g6K6K5oiQ5Y+W5b6X5a2X5Liy6LOH6KiK55qE5pa55rOVXHJcbiAgICAgICAgICAgICAgICAvL3RoaXNPYmouU2V0QmluZGluZ1ZhbHVlKCk7ICAvLyDorormiJDlm57lgrNpbnB1dCB0YWfpm4blkIgg54S25b6M5YaN5LiK5bGk6Ieq6KGM5rG65a6a5Yqg5Zyo5ZOq5YCLVGFnXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gQWN0aW9uICAgIFxyXG4gICAgICAgICAgICB0aGlzLkFsbFByb2RJdGVtTHMucHVzaChsaVRhZyk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBHZXRQZXJjZW50UmVzdWx0KHBlcmNlbnRTdHI6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIGBcXHUwMEEwXFx1MDBBMCR7cGVyY2VudFN0cn0lXFx1MDBBMFxcdTAwQTBgXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIFJlbW92ZShwcm9kSXRlbVZhbDogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IHdSZW1vdmVJdGVtID0gdGhpcy5BbGxQcm9kSXRlbUxzLmZpbmQoaXRlbSA9PiBpdGVtLmRhdGFzZXQudmFsdWUgPT09IHByb2RJdGVtVmFsKTtcclxuICAgICAgICB0aGlzLkFsbFByb2RJdGVtTHMuc3BsaWNlKHRoaXMuQWxsUHJvZEl0ZW1Mcy5pbmRleE9mKHdSZW1vdmVJdGVtKSwgMSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyBSZWZyZXNoUHJvZEl0ZW1QZXJjZW50KCkge1xyXG4gICAgICAgIHRoaXMuQWxsUHJvZEl0ZW1Mcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgIGxldCBzcGFuVGFnID0gaXRlbS5xdWVyeVNlbGVjdG9yKFwic3BhblwiKTtcclxuICAgICAgICAgICAgc3BhblRhZy5pbm5lckhUTUwgPSBgXFx1MDBBMFxcdTAwQTAke2l0ZW0uZGF0YXNldC5wZXJjZW50fSVcXHUwMEEwXFx1MDBBMGBcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgR2V0VG90YWxJbmZvTXNnKCk6IHN0cmluZyB7XHJcblxyXG4gICAgICAgIGxldCBhbGxQZXJjZW50ID0gMDtcclxuICAgICAgICBsZXQgbWF4SXRlbTogSFRNTExJRWxlbWVudDtcclxuICAgICAgICB0aGlzLkFsbFByb2RJdGVtTHMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICBhbGxQZXJjZW50ID0gKyBpdGVtLmRhdGFzZXQucGVyY2VudCArIGFsbFBlcmNlbnQ7XHJcbiAgICAgICAgICAgIGlmICghbWF4SXRlbSkge1xyXG4gICAgICAgICAgICAgICAgbWF4SXRlbSA9IGl0ZW07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBtYXhJdGVtID0gK21heEl0ZW0uZGF0YXNldC5wZXJjZW50ID4gK2l0ZW0uZGF0YXNldC5wZXJjZW50ID8gbWF4SXRlbSA6IGl0ZW07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcblxyXG5cclxuICAgICAgICBjb25zdCBpdGVtU3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIGl0ZW1TcGFuLmlubmVySFRNTCA9IGDvvIzlt7Lpgbgke3RoaXMuQWxsUHJvZEl0ZW1Mcy5sZW5ndGh96aCFYDtcclxuICAgICAgICBjb25zdCBwZXJjZW50U3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIHBlcmNlbnRTcGFuLmlubmVySFRNTCA9IGDvvIzmr5TkvovliqDnuL06JHthbGxQZXJjZW50fSVgXHJcbiAgICAgICAgaWYgKGFsbFBlcmNlbnQgPiAxMDApXHJcbiAgICAgICAgICAgIHBlcmNlbnRTcGFuLnN0eWxlLmNvbG9yID0gXCJyZWRcIjtcclxuICAgICAgICBjb25zdCByZWNvZ25pdGlvblNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuXHJcbiAgICAgICAgcmVjb2duaXRpb25TcGFuLmlubmVySFRNTCA9IGDoqo3liJfpoIXnm64gOiAke21heEl0ZW0/LmRhdGFzZXQudGV4dCA/PyBcIueEoVwifWBcclxuXHJcblxyXG5cclxuICAgICAgICByZXR1cm4gYCR7cmVjb2duaXRpb25TcGFuLmlubmVySFRNTH0ke2l0ZW1TcGFuLmlubmVySFRNTH0ke3BlcmNlbnRTcGFuLmlubmVySFRNTH1gXHJcblxyXG5cclxuICAgICAgICAvL2lmICh0aGlzLkFsbFByb2RJdGVtTHMubGVuZ3RoID4gMClcclxuICAgICAgICAvLyAgICAkKCcjSXNQYXNzUHVyY2hhc2UnKS52YWwoXCJ0cnVlXCIpO1xyXG4gICAgICAgIC8vZWxzZVxyXG4gICAgICAgIC8vICAgICQoJyNJc1Bhc3NQdXJjaGFzZScpLnZhbChcImZhbHNlXCIpO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbiJdfQ==